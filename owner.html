<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç®¡ç†ç”»é¢ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ç”¨ï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      color: #111;
      line-height: 1.6;
    }

    .layout {
      display: flex;
      min-height: 100vh;
      align-items: stretch;   /* å­è¦ç´ ã‚’ç¸¦ã„ã£ã±ã„ã«ãã‚ãˆã‚‹ */
    }

    /* ===== ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ ===== */
    .login-wrap {
      max-width: 360px;
      margin: 80px auto;
      background: #fff;
      border-radius: 12px;
      padding: 20px 18px 18px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    .login-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .login-sub {
      font-size: 12px;
      color: #666;
      margin-bottom: 14px;
    }
    .login-wrap label {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
      display: block;
    }
    .login-wrap input[type="text"],
.login-wrap input[type="password"] {
  width: 100%;
  font-family: inherit;
  font-size: 14px;
  padding: 7px 9px;
  border-radius: 8px;
  border: 1px solid #ccc;
  outline: none;
}
.login-wrap input[type="text"]:focus,
.login-wrap input[type="password"]:focus {
  border-color: #111;
}

    .login-wrap input[type="password"]:focus {
      border-color: #111;
    }
    .login-btn-row {
      margin-top: 12px;
      display: flex;
      justify-content: flex-end;
    }
    .login-btn {
      background: #111;
      color: #fff;
      border-radius: 999px;
      border: none;
      padding: 7px 16px;
      font-size: 13px;
      cursor: pointer;
    }
    .login-error {
      margin-top: 8px;
      font-size: 12px;
      color: #c00;
      min-height: 16px;
    }
    .login-note {
      margin-top: 10px;
      font-size: 11px;
      color: #777;
      line-height: 1.5;
    }

    /* ===== å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆã‚¿ã‚¤ãƒŸãƒ¼é¢¨ï¼‰ ===== */
.sidebar {
  width: 230px;
  background: #f7f7f8;
  border-right: 1px solid #ddd;
  padding: 12px 10px 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  /* â†“ ã“ã“ã‚’å¤‰æ›´ */
  /* position: sticky;  ã¯ä¸€æ—¦ãƒŠã‚·ã«ã™ã‚‹  */
  /* top: 0;            ã‚‚å‰Šé™¤ */
  /* align-self: flex-start; ã‚‚å‰Šé™¤ */
  min-height: 100vh;        /* ç”»é¢ã®é«˜ã•ã¶ã‚“ã¯å¿…ãšå¡—ã‚‹ */
}


    .sidebar-header {
      padding: 4px 8px 6px;
    }
    .sidebar-store {
      font-size: 13px;
      font-weight: 600;
    }
    .sidebar-role {
      font-size: 11px;
      color: #777;
      margin-top: 2px;
    }

    /* â˜… ã‚ªãƒ¼ãƒŠãƒ¼ID / ç«¯æœ«åå…¥åŠ›æ¬„ */
    .sidebar-owner-id {
      margin-top: 8px;
      padding: 4px 2px 2px;
    }
    .sidebar-owner-id label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 3px;
    }
    .sidebar-owner-id input {
      width: 100%;
      font-family: inherit;
      font-size: 12px;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      outline: none;
    }
    .sidebar-owner-id input:focus {
      border-color: #111;
    }
    .sidebar-owner-id .hint {
      font-size: 10px;
      color: #777;
      margin-top: 2px;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 8px;
    }

    .sidebar-nav button {
      text-align: left;
      border-radius: 6px;
      border: none;
      padding: 7px 10px;
      font-size: 13px;
      background: transparent;
      cursor: pointer;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sidebar-nav button span.badge {
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      background: #eee;
      color: #666;
      margin-left: 4px;
    }

    .sidebar-nav button:hover {
      background: #e9eefc;
    }

    .sidebar-nav button.active {
      background: #1a73e8;
      color: #fff;
    }
    .sidebar-nav button.active span.badge {
      background: rgba(255,255,255,0.2);
      color: #fff;
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 10px;
      color: #999;
      padding: 0 8px;
    }

    /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒ©ãƒ™ãƒ« */
    .sidebar-nav button .label {
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
    }
    .sidebar-nav button .label-icon {
      width: 18px;
      text-align: center;
      font-size: 14px;
      flex-shrink: 0;
    }
    .sidebar-nav button .label-text {
      flex: 1;
    }

    /* ===== å³ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ ===== */
    .main {
      flex: 1;
      padding: 16px 20px 24px;
    }

    .main-header {
      margin-bottom: 12px;
    }
    .main-header-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .main-header-sub {
      font-size: 12px;
      color: #666;
    }

    .view-panel { display: none; }
    .view-panel.active { display: block; }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 14px 16px 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }

    .card h2 {
      font-size: 15px;
      margin-bottom: 2px;
    }
    .card-sub {
      font-size: 11px;
      color: #777;
      margin-bottom: 10px;
    }

    label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    input[type="text"],
    input[type="date"],
    textarea,
    select {
      width: 100%;
      font-family: inherit;
      font-size: 13px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      outline: none;
    }
    textarea {
      min-height: 80px;
      resize: vertical;
      line-height: 1.5;
    }
    input[type="text"]:focus,
    input[type="date"]:focus,
    textarea:focus,
    select:focus {
      border-color: #111;
    }

    select {
      padding: 4px 8px;
      font-size: 13px;
      background: #fff;
    }

    /* A/Bã‚¿ã‚¹ã‚¯ textareaã‚’ç¸¦é•·ã« */
    #tasksAInput,
    #tasksBInput {
      min-height: 220px;
    }

/* â˜… è¿½åŠ ï¼šæ™‚é–“å¸¯ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã‚‚ç¸¦é•·ã«ã™ã‚‹ */
#slotCustomInput {
  min-height: 220px;   /* å¥½ããªé«˜ã•ã«èª¿æ•´ã—ã¦OKï¼ˆä¾‹ï¼š180pxã¨ã‹ï¼‰ */
}
    

    .row { margin-bottom: 10px; }

    .hint {
      font-size: 11px;
      color: #777;
      margin-top: 2px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    button {
      font-family: inherit;
      font-size: 13px;
      border-radius: 999px;
      border: none;
      padding: 6px 14px;
      cursor: pointer;
    }
    .btn-primary {
      background: #111;
      color: #fff;
    }
    .btn-secondary {
      background: #eee;
      color: #333;
    }
    .btn-danger {
      background: #f44;
      color: #fff;
    }

    .status {
      font-size: 12px;
      min-height: 18px;
      margin-top: 2px;
    }
    .status.ok { color: #007700; }
    .status.err { color: #cc0000; }

    hr {
      border: none;
      border-top: 1px solid #eee;
      margin: 10px 0;
    }

    /* ownerNews list */
    .news-list {
      list-style: none;
      font-size: 12px;
      max-height: 280px;
      overflow-y: auto;
      padding-right: 4px;
    }
    .news-item {
      border-bottom: 1px solid #eee;
      padding: 6px 0;
      display: flex;
      gap: 8px;
    }
    .news-main { flex: 1; }
    .news-title { font-weight: 600; margin-bottom: 2px; }
    .news-body { font-size: 12px; }
    .news-meta {
      font-size: 10px;
      color: #888;
      margin-top: 2px;
    }
    .news-actions {
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-end;
    }

    .slot-note {
      font-size: 11px;
      color: #666;
      margin-top: -2px;
      margin-bottom: 6px;
    }

    /* å¼•ãç¶™ããƒ¡ãƒ¢ ãƒ†ãƒ³ãƒ—ãƒ¬ preview */
    .handover-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      padding: 6px 4px;
      background: #fafafa;
      border-radius: 8px;
      border: 1px dashed #ddd;
    }
    .handover-preview-chip {
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid #ddd;
      white-space: nowrap;
    }

    /* ã‚¹ã‚¿ãƒƒãƒ•ãƒ­ã‚° table */
    .log-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: flex-end;
      margin-bottom: 10px;
    }
    .log-filters .field {
      min-width: 160px;
      max-width: 220px;
      flex: 1;
    }

    table.log-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 4px;
    }
    .log-table th,
    .log-table td {
      border-bottom: 1px solid #eee;
      padding: 4px 6px;
      text-align: left;
      vertical-align: top;
    }
    .log-table th {
      background: #fafafa;
      font-weight: 600;
    }
    .log-empty {
      font-size: 12px;
      color: #777;
      margin-top: 6px;
    }

    /* ã‚·ãƒ•ãƒˆè¡¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ */
    #shiftImagePreview {
      max-width: 100%;
      max-height: 400px;
      display: none;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-top: 8px;
    }

    /* ===== Analyticsï¼ˆã‚°ãƒ©ãƒ•ï¼‰ ===== */
    .analytics-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: flex-end;
    }
    .analytics-controls .field {
      min-width: 160px;
      max-width: 220px;
      flex: 1;
    }

    .summary-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0 12px;
    }
    .summary-card {
      flex: 0 0 160px;
      background: #f8fafc;
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px solid #e2e8f0;
    }
    .summary-title {
      font-size: 11px;
      color: #666;
      margin-bottom: 2px;
    }
    .summary-value {
      font-size: 20px;
      font-weight: 700;
    }
    .summary-note {
      font-size: 10px;
      color: #777;
      margin-top: 2px;
    }

    .analytics-chart-wrap {
      width: 100%;
      height: 260px;
      margin-top: 6px;
      margin-bottom: 10px;
      padding: 4px;
    }

    .subsection-title {
      font-size: 13px;
      font-weight: 600;
      margin-top: 10px;
      margin-bottom: 4px;
    }

    .analytics-table th:nth-child(1) { width: 160px; }
    .analytics-table th:nth-child(2) { width: 80px; }

    /* === ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒˆãƒƒãƒ—ãƒãƒ¼ & ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ === */
    .mobile-topbar {
      display: none;
    }

    @media (max-width: 900px) {
      .mobile-topbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 48px;
        background: #111;
        color: #fff;
        display: flex;
        align-items: center;
        padding: 0 10px;
        z-index: 2000;
      }

      .mobile-topbar-title {
        font-size: 14px;
        font-weight: 600;
        margin-left: 8px;
      }

      .mobile-menu-btn {
        width: 36px;
        height: 36px;
        border-radius: 999px;
        border: none;
        background: #333;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        padding: 0;
        margin-right: 6px;
        cursor: pointer;
      }

      .layout {
        flex-direction: column;
        padding-top: 52px;
      }

      .sidebar {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        width: 70%;
        max-width: 260px;
        transform: translateX(-100%);
        transition: transform 0.2s ease-out;
        z-index: 2100;
      }
      .sidebar.mobile-open {
        transform: translateX(0);
      }

      .sidebar-footer {
        margin-top: auto;
      }

      .main {
        padding: 12px 12px 20px;
      }

      .sidebar-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.35);
        z-index: 2050;
        display: none;
      }
      .sidebar-overlay.active {
        display: block;
      }
    }


/* ãŠçŸ¥ã‚‰ã›æœ¬æ–‡ã®ç¸¦å¹…ã‚’é•·ãã™ã‚‹ */
#newsBody {
  min-height: 220px;  /* å¥½ãã«èª¿æ•´ã—ã¦OKï¼ˆä¾‹ï¼š200ã€œ260pxï¼‰ */
}

/* å¼•ãç¶™ããƒ¡ãƒ¢ã®ãƒœã‚¿ãƒ³æ–‡è¨€ãƒªã‚¹ãƒˆã‚’ç¸¦é•·ã«ã™ã‚‹ */
#handoverChipsInput {
  min-height: 260px;  /* ã€Œ1.5å€ãã‚‰ã„ã€ãªã‚‰ã“ã®ãã‚‰ã„ã§è‰¯ã•ãã† */
  font-size: 14px;
  line-height: 1.6;
  padding: 10px;
}


.ai-btn {
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 9999;
  background: #111;
  color: #fff;
  padding: 8px 14px;
  border-radius: 8px;
  font-size: 13px;
  border: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  display: none; /* â† æœ€åˆã¯éè¡¨ç¤º */
}
.ai-btn:active {
  opacity: 0.7;
}










    

/* ========== ã‚·ãƒ•ãƒˆAIã‚¿ãƒ–ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ========== */
.shiftai-layout {
  max-width: 1100px;
  margin: 0 auto 32px;
  padding: 4px;
}

/* ä¸Šã®èª¬æ˜ãƒ˜ãƒƒãƒ€ãƒ¼ */
.shiftai-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 14px;
}

.shiftai-title {
  font-size: 16px;
  font-weight: 600;
}

.shiftai-subtitle {
  font-size: 12px;
  color: #666;
}

.shiftai-tag {
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 10px;
  background: #111;
  color: #fff;
}

/* ã‚«ãƒ¼ãƒ‰æœ¬ä½“ï¼šæ—¢å­˜ .card ã«è¿‘ã„é›°å›²æ°— */
.shiftai-card {
  background: #fff;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 1px 3px rgba(15, 23, 42, 0.04);
  padding: 16px 18px;
  margin-bottom: 16px;
}

.shiftai-card-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 8px;
}

/* è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
.shiftai-row {
  display: flex;
  gap: 12px;
  margin-bottom: 10px;
  align-items: flex-start;
}

.shiftai-label {
  width: 90px;
  font-size: 11px;
  font-weight: 600;
  color: #444;
  padding-top: 3px;
}

.shiftai-field {
  flex: 1;
  font-size: 12px;
}

/* ãƒ©ã‚¸ã‚ªãƒ»ãƒãƒƒãƒ— */
.shiftai-radio {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  margin-right: 14px;
  font-size: 12px;
}

.shiftai-date-input {
  padding: 4px 8px;
  font-size: 12px;
}

.shiftai-help {
  font-size: 11px;
  color: #777;
  margin-top: 3px;
}

.shiftai-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.shiftai-chip {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid #e5e7eb;
  font-size: 11px;
  background: #f9fafb;
}

/* ãƒœã‚¿ãƒ³ã¾ã‚ã‚Š */
.shiftai-actions {
  margin-top: 14px;
}

.shiftai-primary-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 7px 18px;
  border-radius: 999px;
  border: none;
  background: #111827;
  color: #fff;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
}

.shiftai-primary-btn:disabled {
  opacity: 0.6;
  cursor: default;
}

.shiftai-note {
  margin-top: 6px;
  font-size: 11px;
  color: #777;
}

/* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼éƒ¨åˆ† */
.shiftai-empty {
  font-size: 12px;
  color: #555;
}

.shiftai-preview-area {
  margin-top: 8px;
}

/* ã‚¹ãƒãƒ›ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
@media (max-width: 720px) {
  .shiftai-row {
    flex-direction: column;
  }
  .shiftai-label {
    width: auto;
  }
}









/* =========================
   ã‚·ãƒ•ãƒˆè¡¨ï¼ˆ1é€±é–“ï¼‰ãƒ‡ã‚¶ã‚¤ãƒ³
   ========================= */
.shiftboard-shell {
  padding: 16px 20px 24px;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 0 0 1px #e5e7eb;
}

/* ä¸Šéƒ¨ãƒ˜ãƒƒãƒ€ãƒ¼ */
.shiftboard-header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 12px;
}

.shiftboard-title {
  font-size: 14px;
  font-weight: 600;
}

.shiftboard-meta {
  font-size: 12px;
  color: #4b5563;
}

.shiftboard-weeknav {
  display: flex;
  align-items: center;
  gap: 4px;
}

.shiftboard-weeknav button {
  border: 1px solid #d1d5db;
  background: #f9fafb;
  border-radius: 4px;
  padding: 3px 8px;
  font-size: 11px;
  cursor: pointer;
}
.shiftboard-weeknav button:hover {
  background: #eef2ff;
}

/* ãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“ */
.shiftboard-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
  font-size: 11px;
  border: 1px solid #9ca3af;
}

/* è¡Œãƒ»ã‚»ãƒ«å…±é€š */
.shiftboard-table th,
.shiftboard-table td {
  border: 1px solid #9ca3af;
  padding: 3px 4px;
  vertical-align: top;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ */
.shiftboard-head-row th {
  background: #e5f3e5;      /* ã¡ã‚‡ã„ç·‘ãŒã‹ã£ãŸã‚°ãƒ¬ãƒ¼ */
  text-align: center;
  font-weight: 500;
  white-space: nowrap;
}

/* å·¦ç«¯ï¼šæ—¥ä»˜ãƒ»æ›œæ—¥ */
.shiftboard-col-date {
  width: 70px;
  text-align: center;
  background: #f9fafb;
  font-weight: 500;
}

/* å³ç«¯ï¼šM/Hãƒ»è¤‡å“¡äººæ•° */
.shiftboard-col-summary {
  width: 70px;
  text-align: right;
  background: #f9fafb;
}

/* ã‚·ãƒ•ãƒˆå…¥åŠ›ã‚»ãƒ« */
.shiftboard-cell {
  min-height: 32px;
  line-height: 1.3;
  position: relative;
}

/* ã‚·ãƒ•ãƒˆå…¥åŠ›æ¬„ã‚’ contenteditable ã«ã—ã¦ãƒ¡ãƒ¢å¸³ã£ã½ã */
.shiftboard-cell[contenteditable="true"] {
  outline: none;
}

/* placeholder é¢¨ã®è¡¨ç¤º */
.shiftboard-cell[data-placeholder]:empty::before {
  content: attr(data-placeholder);
  position: absolute;
  top: 3px;
  left: 4px;
  font-size: 10px;
  color: #9ca3af;
}

/* è¡Œã”ã¨ã®èƒŒæ™¯ã®ã—ã¾ã—ã¾æ„Ÿ */
.shiftboard-body-row:nth-child(odd) td {
  background: #fdfdfd;
}
.shiftboard-body-row:nth-child(even) td {
  background: #f7faf7;
}

/* æ—¥ä»˜ã‚»ãƒ«ã®è‰²åˆ†ã‘ï¼ˆä¾‹ï¼šåœŸæ—¥ï¼‰ */
.shiftboard-day-sat {
  color: #2563eb;
}
.shiftboard-day-sun {
  color: #dc2626;
}

/* ä¸‹ã®ã€Œé€±åˆè¨ˆã€è¡Œ */
.shiftboard-footer-row td {
  background: #fffde7;
  font-weight: 600;
}
.shiftboard-footer-label {
  text-align: right;
}


    








/* ========== ã‚·ãƒ•ãƒˆè¡¨ãƒ‡ã‚¶ã‚¤ãƒ³ ========== */

.shiftboard-toolbar {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 8px 0 12px;
}

.shiftboard-week-control {
  display: flex;
  gap: 4px;
}

.shiftboard-meta {
  font-size: 12px;
  color: #555;
}

.shiftboard-actions {
  margin-left: auto;
}

.shiftboard-shell {
  border: 1px solid #e2e2e2;
  border-radius: 8px;
  overflow: hidden;
  background: #fff;
  box-shadow: 0 2px 6px rgba(15, 23, 42, 0.03);
}

.shiftboard-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
  font-size: 11px;
}

.shiftboard-table thead {
  background: linear-gradient(to bottom, #fafafa, #f3f4f6);
}

.shiftboard-table th,
.shiftboard-table td {
  border: 1px solid #e5e5e5;
  padding: 2px 3px;
  text-align: center;
}

.shiftboard-col-date {
  width: 72px;
  background: #fafafa;
  font-weight: 600;
  vertical-align: top;
}

.shiftboard-date-main {
  font-size: 12px;
}

.shiftboard-date-week {
  font-size: 11px;
  color: #555;
}

.shiftboard-date-week.sat {
  color: #2563eb;
}

.shiftboard-date-week.sun {
  color: #ef4444;
}

.shiftboard-col-hour {
  width: 32px;
  font-weight: 500;
  color: #4b5563;
}

.shiftboard-col-mh,
.shiftboard-col-people {
  width: 60px;
  background: #fafafa;
  font-weight: 600;
}

.shiftboard-empty {
  background: #fff;
}

.shiftboard-bar-cell {
  padding: 0;
  background: #f9fafb;
}

.shiftboard-bar {
  height: 24px;
  margin: 1px;
  border-radius: 999px;
  background: linear-gradient(90deg, #eef2ff, #e0f2fe);
  border: 1px solid rgba(129, 140, 248, 0.45);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 0 8px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
}

.shiftboard-bar-name {
  font-weight: 600;
  color: #111827;
}

.shiftboard-bar-time {
  font-size: 10px;
  color: #4b5563;
}















    



    



    

    
    
  </style>
</head>
<body>
  <!-- â‘  ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
  <div id="ownerLogin" class="login-wrap">
    <div class="login-title">ç®¡ç†è€… ãƒ­ã‚°ã‚¤ãƒ³</div>
    <div class="login-sub">
      ç®¡ç†ç”»é¢ã«å…¥ã‚‹ãŸã‚ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
    </div>

    <label for="storeIdInput">åº—èˆ—ID</label>
    <input
      id="storeIdInput"
      type="text"
      placeholder="ä¾‹ï¼šnambucho"
      autocomplete="off"
    />

    <label for="ownerPasswordInput">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
    <input
      id="ownerPasswordInput"
      type="password"
      placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
      autocomplete="current-password"
    />

    <div class="login-btn-row">
      <button id="ownerLoginBtn" class="login-btn" type="button">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </div>

    <p id="ownerLoginError" class="login-error"></p>

    <p class="login-note">
      â€»ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã¯åŒã˜ç«¯æœ«ãƒ»åŒã˜ãƒ–ãƒ©ã‚¦ã‚¶ã§ç´„15æ™‚é–“ç¶­æŒã•ã‚Œã¾ã™ã€‚<br>
      â€»æ™‚é–“ãŒçµŒã¤ã¨è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã•ã‚Œã¾ã™ã€‚
    </p>
  </div>

  <!-- â‘¡ æœ¬ä½“ã‚¢ãƒ—ãƒªï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œã«è¡¨ç¤ºï¼‰ -->
  <div id="ownerApp" style="display:none;">
    <!-- ğŸ‘‡ã“ã“ã«AIãƒœã‚¿ãƒ³ -->
    <button id="aiOptimizeBtn" class="ai-btn">
      ğŸ¤– AIæœ€é©åŒ–
    </button>

    <!-- â˜…ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒˆãƒƒãƒ—ãƒãƒ¼ -->
    <div class="mobile-topbar">
      <button type="button" class="mobile-menu-btn" id="mobileMenuBtn">â˜°</button>
      <div class="mobile-topbar-title">ç®¡ç†ç”»é¢</div>
    </div>

    <!-- â˜…ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®å¾Œã‚ã®é»’èƒŒæ™¯ -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="layout">
      <!-- ================= å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ================= -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-role">ç®¡ç†ç”»é¢</div>

          <!-- â˜… ã‚ªãƒ¼ãƒŠãƒ¼/åº—é•· ID / ç«¯æœ«å -->
          <div class="sidebar-owner-id">
            <label for="ownerIdInput">ç®¡ç†è€…ID / ç«¯æœ«å</label>
            <input
              id="ownerIdInput"
              type="text"
              placeholder="ä¾‹: ã‚ªãƒ¼ãƒŠãƒ¼iPhone / äº‹å‹™æ‰€PC"
            />
            <div class="hint">â€»ã“ã®ç«¯æœ«ã®åå‰ã€‚ãƒ­ã‚°ã®ç®¡ç†ãƒ¡ãƒ¢ç”¨ã€‚</div>
          </div>
        </div>

        <nav class="sidebar-nav">
          <button type="button" data-view="news" class="active">
            <span class="label">
              <span class="label-icon">ğŸ›</span>
              <span class="label-text">ãŠçŸ¥ã‚‰ã›ç®¡ç†</span>
            </span>
          </button>

          <!-- â˜… ãŠçŸ¥ã‚‰ã›ã‚»ãƒ³ã‚¿ãƒ¼ï¼ˆåˆ¥ãƒšãƒ¼ã‚¸ï¼‰ -->
          <button type="button" data-view="notice-center">
            <span class="label">
              <span class="label-icon">ğŸ“¢</span>
              <span class="label-text">ãŠçŸ¥ã‚‰ã›ã‚»ãƒ³ã‚¿ãƒ¼</span>
            </span>
          </button>

          <button type="button" data-view="tasks">
            <span class="label">
              <span class="label-icon">ğŸ“</span>
              <span class="label-text">æ™‚é–“å¸¯ã”ã¨ã®ã‚¿ã‚¹ã‚¯ç·¨é›†</span>
            </span>
          </button>

          <button type="button" data-view="handover">
            <span class="label">
              <span class="label-icon">ğŸ“’</span>
              <span class="label-text">å¼•ãç¶™ããƒ¡ãƒ¢ï¼ˆãƒœã‚¿ãƒ³ç·¨é›†ï¼‰</span>
            </span>
          </button>

          <button type="button" data-view="logs">
            <span class="label">
              <span class="label-icon">â±</span>
              <span class="label-text">ã‚¹ã‚¿ãƒƒãƒ•ãƒ­ã‚°</span>
            </span>
          </button>

          <button type="button" data-view="analytics">
            <span class="label">
              <span class="label-icon">ğŸ“Š</span>
              <span class="label-text">ã‚°ãƒ©ãƒ•åˆ†æï¼ˆÎ²ï¼‰</span>
            </span>
          </button>

          <!-- ğŸ†• ã‚·ãƒ•ãƒˆè¡¨ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆæ¨ªæ£’ã‚¿ã‚¤ãƒ—ï¼‰ -->
          <button type="button" data-view="shiftboard">
            <span class="label">
              <span class="label-icon">ğŸ“…</span>
              <span class="label-text">ã‚·ãƒ•ãƒˆè¡¨ãƒ‡ã‚¶ã‚¤ãƒ³</span>
            </span>
          </button>

          <!-- å¾“æ¥ã®ç”»åƒURLç‰ˆ -->
          <button type="button" data-view="shift">
            <span class="label">
              <span class="label-icon">ğŸ–¼</span>
              <span class="label-text">ã‚·ãƒ•ãƒˆè¡¨ç”»åƒURL</span>
            </span>
          </button>

          <button type="button" data-view="shiftai">
            <span class="label">
              <span class="label-icon">ğŸ§ </span>
              <span class="label-text">ã‚·ãƒ•ãƒˆä½œæˆ</span>
            </span>
          </button>
        </nav>

        <div class="sidebar-footer">
          ã“ã®ç”»é¢ã§è¨­å®šã—ãŸå†…å®¹ãŒã€ã‚¹ã‚¿ãƒƒãƒ•ç”¨ãƒã‚§ãƒƒã‚¯ç”»é¢ã«åæ˜ ã•ã‚Œã¾ã™ã€‚
        </div>
      </aside>

      <!-- ================= å³ãƒ¡ã‚¤ãƒ³ ================= -->
      <main class="main">
        <header class="main-header">
          <div class="main-header-title">ç®¡ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
          <div class="main-header-sub">
            å·¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ç·¨é›†ã—ãŸã„é …ç›®ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
          </div>
        </header>

        <!-- â‘  ãŠçŸ¥ã‚‰ã›ç®¡ç† -->
        <section id="view-news" class="view-panel active">
          <section class="card" id="news-card">
            <h2>ãŠçŸ¥ã‚‰ã›ç®¡ç†ï¼ˆownerNewsï¼‰</h2>
            <p class="card-sub">
              ã‚¹ã‚¿ãƒƒãƒ•ç”»é¢ã®ã€ŒãŠçŸ¥ã‚‰ã›ã€æ¬„ã«è¡¨ç¤ºã•ã‚Œã‚‹å†…å®¹ã‚’ç™»éŒ²ãƒ»å‰Šé™¤ã§ãã¾ã™ã€‚
            </p>

            <div class="row">
              <label for="newsTitle">ã‚¿ã‚¤ãƒˆãƒ«</label>
              <input type="text" id="newsTitle" placeholder="ä¾‹ï¼‰FFæ²¹äº¤æ›ã«ã¤ã„ã¦" />
            </div>
            <div class="row">
              <label for="newsBody">æœ¬æ–‡</label>
              <textarea id="newsBody" placeholder="ä¾‹ï¼‰ä»Šé€±ã¯æ²¹äº¤æ›ã®é »åº¦ã‚’1æ—¥2å›ã«å¢—ã‚„ã—ã¦ãã ã•ã„ã€‚å¤œå‹¤å¸¯ã§å¯¾å¿œãŠé¡˜ã„ã—ã¾ã™ã€‚"></textarea>
            </div>

            <div class="btn-row">
              <button type="button" class="btn-primary" id="newsAddBtn">ãŠçŸ¥ã‚‰ã›ã‚’è¿½åŠ </button>
              <button type="button" class="btn-secondary" id="newsClearFormBtn">å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢</button>
            </div>
            <div class="status" id="newsStatus"></div>

            <hr>

            <p class="hint">â€»æœ€æ–°20ä»¶ã¾ã§è¡¨ç¤ºã€‚å¤ã„ã‚‚ã®ã‹ã‚‰é †ã«å‰Šé™¤ã—ã¦OKã§ã™ã€‚</p>
            <ul class="news-list" id="newsList"></ul>
          </section>
        </section>

        <!-- â‘¡ æ™‚é–“å¸¯ã‚¿ã‚¹ã‚¯ç·¨é›† -->
        <section id="view-tasks" class="view-panel">
          <section class="card" id="tasks-card">
            <h2>æ™‚é–“å¸¯ã”ã¨ã®ã‚¿ã‚¹ã‚¯ç·¨é›†ï¼ˆtaskSlotsï¼‰</h2>
            <p class="card-sub">
              â‘  æ™‚é–“å¸¯ã®è‡ªå‹•ç”Ÿæˆã§ã€Œéª¨çµ„ã¿ã€ã‚’ä½œã‚Šã€<br>
              â‘¡ å„æ™‚é–“å¸¯ã”ã¨ã®ã‚¿ã‚¹ã‚¯ã‚’ç·¨é›†ã—ã¦ã€<br>
              â‘¢ å¿…è¦ãªã‚‰ã‚«ã‚¹ã‚¿ãƒ ç·¨é›†ã§ç´°ã‹ãèª¿æ•´ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚
            </p>

            <!-- â‘  æ™‚é–“å¸¯ã®è‡ªå‹•ç”Ÿæˆ -->
            <div class="row">
              <label>æ™‚é–“å¸¯ã®è‡ªå‹•ç”Ÿæˆï¼ˆå–¶æ¥­é–‹å§‹ã€œçµ‚äº†ã¨åŒºåˆ‡ã‚Šæ™‚é–“ï¼‰</label>
              <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:flex-end;">
                <div style="min-width:120px;">
                  <div style="font-size:11px;color:#555;">é–‹å§‹</div>
                  <input type="time" id="slotConfigStart" value="06:00" />
                </div>
                <div style="min-width:120px;">
                  <div style="font-size:11px;color:#555;">çµ‚äº†</div>
                  <input type="time" id="slotConfigEnd" value="23:00" />
                </div>
                <div style="min-width:150px;">
                  <div style="font-size:11px;color:#555;">åŒºåˆ‡ã‚Š</div>
                  <select id="slotConfigInterval">
                    <option value="15">15åˆ†ã”ã¨</option>
                    <option value="30">30åˆ†ã”ã¨</option>
                    <option value="60">1æ™‚é–“ã”ã¨</option>
                    <option value="120">2æ™‚é–“ã”ã¨</option>
                    <option value="180" selected>3æ™‚é–“ã”ã¨</option>
                    <option value="240">4æ™‚é–“ã”ã¨</option>
                    <option value="300">5æ™‚é–“ã”ã¨</option>
                  </select>
                </div>
                <div>
                  <button type="button" class="btn-secondary" id="slotConfigGenerateBtn">
                    ã“ã®è¨­å®šã§æ™‚é–“å¸¯ã‚’è‡ªå‹•ç”Ÿæˆ
                  </button>
                </div>
              </div>
              <p class="hint">
                â€»ã€Œé–‹å§‹ã€ã€Œçµ‚äº†ã€ã¨ã€ŒåŒºåˆ‡ã‚Šæ™‚é–“ã€ã‚’å¤‰ãˆã¦ã€Œè‡ªå‹•ç”Ÿæˆã€ã™ã‚‹ã¨ã€æ™‚é–“å¸¯ã®ãƒªã‚¹ãƒˆãŒä½œã‚Šç›´ã•ã‚Œã¾ã™ã€‚<br>
                â€»æ™‚é–“å¸¯ã‚’ä½œã‚Šç›´ã™ã¨ã€æ–°ã—ã„æ™‚é–“å¸¯IDã”ã¨ã«ã‚¿ã‚¹ã‚¯ã‚’ç®¡ç†ã§ãã¾ã™ï¼ˆã‚¿ã‚¹ã‚¯å†…å®¹ã¯ä¸‹ã®å…¥åŠ›æ¬„ã§ç·¨é›†ï¼‰ã€‚
              </p>
            </div>

            <hr>

            <!-- â‘¡ æ™‚é–“å¸¯ã”ã¨ã®ã‚¿ã‚¹ã‚¯ç·¨é›† -->
<div class="row">
  <label for="slotSelect">ç·¨é›†ã™ã‚‹æ™‚é–“å¸¯</label>
  <select id="slotSelect"></select>
  <p class="slot-note">
    æ™‚é–“å¸¯ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ãã®æ™‚é–“å¸¯ã®ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ Firestore ã‹ã‚‰èª­ã¿è¾¼ã¿ã¾ã™ã€‚
  </p>
</div>

<!-- ğŸ†• A-1ï¼šå†™çœŸå¿…é ˆã‚¿ã‚¹ã‚¯ -->
<div class="row">
  <label for="tasksPhotoInput">Aã‚¿ã‚¹ã‚¯ï¼ˆå¿…é ˆ ï¼‹ å†™çœŸæŠ•ç¨¿ï¼‰</label>
  <textarea
    id="tasksPhotoInput"
    placeholder="ä¾‹ï¼‰&#10;FFã‚±ãƒ¼ã‚¹å†…éƒ¨æ¸…æƒï¼ˆæ‰‰ã‚’é–‹ã‘ã¦æ’®å½±ï¼‰&#10;ãƒ›ãƒƒãƒˆã‚·ãƒ§ãƒ¼ã‚±ãƒ¼ã‚¹å†…éƒ¨æ¸…æƒï¼ˆä¸­ã®çŠ¶æ…‹ãŒã‚ã‹ã‚‹å†™çœŸï¼‰"
  ></textarea>
  <div class="hint">
    â€»1è¡Œã«ã¤ã1ã‚¿ã‚¹ã‚¯ã€‚å†™çœŸãŒå¿…é ˆã®Aã‚¿ã‚¹ã‚¯ã ã‘æ›¸ã„ã¦ã­ã€‚<br>
    â€»ã‚¹ã‚¿ãƒƒãƒ•ç”»é¢ã§ã¯ Aã‚¿ã‚¹ã‚¯ã®ä¸­ã«æ··ã–ã£ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã‘ã©ã€<br>
    <strong>å†™çœŸæŠ•ç¨¿ãŒå®Œäº†ã™ã‚‹ã¾ã§ãƒã‚§ãƒƒã‚¯ã§ããªã„</strong>ã‚ˆã†ã«ãªã‚‹ã‚ˆï¼
  </div>
</div>

<!-- A-2ï¼šæ™®é€šã®å¿…é ˆã‚¿ã‚¹ã‚¯ -->
<div class="row">
  <label for="tasksAInput">Aã‚¿ã‚¹ã‚¯ï¼ˆå¿…é ˆãƒ»ãƒã‚§ãƒƒã‚¯ã®ã¿ï¼‰</label>
  <textarea
    id="tasksAInput"
    placeholder="ä¾‹ï¼‰&#10;ãƒ¬ã‚¸å‰FFå‰é™³&#10;ç±³é£¯ãƒ»ãŠã«ãã‚Š å‰é™³ï¼†æ•´ç†"
  ></textarea>
  <div class="hint">
    â€»å†™çœŸãŒä¸è¦ãª Aã‚¿ã‚¹ã‚¯ã¯ã“ã“ã€‚1è¡Œã«ã¤ã1ã‚¿ã‚¹ã‚¯ã€‚
  </div>
</div>

<!-- Bï¼šä½™è£•ã‚ã‚Œã° -->
<div class="row">
  <label for="tasksBInput">Bã‚¿ã‚¹ã‚¯ï¼ˆä½™è£•ã‚ã‚Œã°ï¼‰</label>
  <textarea
    id="tasksBInput"
    placeholder="ä¾‹ï¼‰&#10;åº—å¤–ã‚´ãƒŸç®±ãƒã‚§ãƒƒã‚¯&#10;ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ æ•´ç†"
  ></textarea>
  <div class="hint">
    â€»1è¡Œã«ã¤ã1ã‚¿ã‚¹ã‚¯ã€‚ç©ºè¡Œã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚
  </div>
</div>

<div class="btn-row">
  <button type="button" class="btn-secondary" id="reloadSlotBtn">
    é¸æŠä¸­ã®æ™‚é–“å¸¯ã‚’å†èª­ã¿è¾¼ã¿
  </button>
  <button type="button" class="btn-primary" id="saveSlotBtn">
    ã“ã®å†…å®¹ã§ä¿å­˜
  </button>
</div>
<div class="status" id="taskStatus"></div>


            <hr>

            <p class="hint">
              â€»ä¿å­˜ã™ã‚‹ã¨ã€ãã®æ™‚é–“å¸¯ã®ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ï¼ˆå®Œäº†ãƒã‚§ãƒƒã‚¯ï¼‰ã ã‘ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ï¼ˆä»–ã®æ™‚é–“å¸¯ã¯ãã®ã¾ã¾ï¼‰ã€‚<br>
              â€»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæœ¬ä½“ã® HTMLï¼ˆã‚¹ã‚¿ãƒƒãƒ•ç”¨ç”»é¢ï¼‰ã¯æ›¸ãæ›ãˆä¸è¦ã§ã™ã€‚ã“ã®ç”»é¢ã¯å®šç¾©ã ã‘ã‚’ã„ã˜ã‚‹å½¹å‰²ã€‚
            </p>

            <hr>

            <!-- â‘¢ ã‚«ã‚¹ã‚¿ãƒ æ™‚é–“å¸¯ç·¨é›† -->
            <div class="row">
              <label>æ™‚é–“å¸¯ã®ã‚«ã‚¹ã‚¿ãƒ ç·¨é›†ï¼ˆä¸è¦å‰‡ãªåŒºåˆ‡ã‚Šã«å¯¾å¿œï¼‰</label>
              <textarea
                id="slotCustomInput"
                placeholder="ä¾‹ï¼‰&#10;06:00-09:00 æœã®ç«‹ã¡ä¸Šã’&#10;09:00-12:00 åˆå‰å¸¯&#10;12:00-14:00 æ˜¼ãƒ”ãƒ¼ã‚¯&#10;14:00-15:00 14æ™‚å»ƒæ£„ãƒ»ä»•è¾¼ã¿å¸¯&#10;15:00-18:00 å¤•æ–¹å‰&#10;18:00-21:00 å¤•æ–¹ã€œå¤œãƒ”ãƒ¼ã‚¯&#10;21:00-22:00 21æ™‚å»ƒæ£„ãƒ»è£œå……&#10;22:00-24:00 å¤œãƒ©ã‚¹ãƒˆ&#10;00:00-03:00 æ·±å¤œå‰åŠ&#10;03:00-06:00 æ—©æœç«‹ã¡ä¸Šã’"
              ></textarea>
              <div class="hint">
                1è¡Œã«ã¤ã1æ™‚é–“å¸¯ã§ã™ã€‚<br>
                å½¢å¼ï¼š<code>HH:MM-HH:MM ãƒ©ãƒ™ãƒ«</code>ï¼ˆãƒ©ãƒ™ãƒ«ã¯ç©ºã§ã‚‚OKã€‚åˆ†ã¯å¿…ãš00ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰
              </div>

              <div class="btn-row">
                <button type="button" class="btn-secondary" id="slotCustomLoadBtn">
                  ç¾åœ¨ã®æ™‚é–“å¸¯ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å±•é–‹
                </button>
                <button type="button" class="btn-primary" id="slotCustomSaveBtn">
                  ã“ã®ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹ã§æ™‚é–“å¸¯ã‚’æ›´æ–°
                </button>
              </div>

              <p class="hint">
                â€»ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã§æ™‚é–“å¸¯ã‚’æ›´æ–°ã™ã‚‹ã¨ã€ä¸Šã®ã€Œç·¨é›†ã™ã‚‹æ™‚é–“å¸¯ã€ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚‚æ–°ã—ã„ãƒªã‚¹ãƒˆã«å…¥ã‚Œæ›¿ã‚ã‚Šã¾ã™ã€‚<br>
                â€»ã‚¿ã‚¹ã‚¯å†…å®¹ã¯ãã®ã¾ã¾æ®‹ã‚Šã¾ã™ãŒã€æ–°ã—ã„æ™‚é–“å¸¯IDã«ã¯æ–°ã—ãã‚¿ã‚¹ã‚¯ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
              </p>
            </div>
          </section>
        </section>

        <!-- â‘¢ ã‚·ãƒ•ãƒˆè¡¨ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆæ¨ªæ£’ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
        <section id="view-shiftboard" class="view-panel">
          <section class="card">
            <h2>ã‚·ãƒ•ãƒˆè¡¨ãƒ‡ã‚¶ã‚¤ãƒ³</h2>
            <p class="card-sub">
              ãƒ­ãƒ¼ã‚½ãƒ³ã®ã€Œã‚·ãƒ•ãƒˆäºˆå®šå®Ÿç¸¾è¡¨ã€é¢¨ã«ã€1é€±é–“åˆ†ã®ã‚·ãƒ•ãƒˆã‚’æ¨ªæ£’ã§è¡¨ç¤ºã—ã¾ã™ã€‚<br>
              ä»Šã¯ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§ã™ãŒã€ã‚ã¨ã§å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚„AIçµæœã‚’ã“ã“ã«æµã—è¾¼ã¿ã¾ã™ã€‚
            </p>

            <div class="shiftboard-toolbar">
              <div class="shiftboard-week-control">
                <button type="button" class="btn-secondary" id="shiftPrevWeekBtn">â—€ å…ˆé€±</button>
                <button type="button" class="btn-secondary" id="shiftThisWeekBtn">ä»Šé€±</button>
                <button type="button" class="btn-secondary" id="shiftNextWeekBtn">ç¿Œé€± â–¶</button>
              </div>
              <div class="shiftboard-meta">
                å¯¾è±¡é€±ï¼š<span id="shiftWeekLabel">2025/12/01 ï½ 2025/12/07</span>
              </div>
              <div class="shiftboard-actions">
                <button type="button" class="btn-secondary" id="shiftPrintBtn">å°åˆ·</button>
              </div>
            </div>

            <div class="shiftboard-shell">
              <table class="shiftboard-table">
                <thead>
                  <tr>
                    <th class="shiftboard-col-date">å‹¤å‹™æ—¥ä»˜</th>
                    <!-- 6ã€œ23, 0ã€œ5 (24æ™‚é–“) -->
                    <th class="shiftboard-col-hour">6</th>
                    <th class="shiftboard-col-hour">7</th>
                    <th class="shiftboard-col-hour">8</th>
                    <th class="shiftboard-col-hour">9</th>
                    <th class="shiftboard-col-hour">10</th>
                    <th class="shiftboard-col-hour">11</th>
                    <th class="shiftboard-col-hour">12</th>
                    <th class="shiftboard-col-hour">13</th>
                    <th class="shiftboard-col-hour">14</th>
                    <th class="shiftboard-col-hour">15</th>
                    <th class="shiftboard-col-hour">16</th>
                    <th class="shiftboard-col-hour">17</th>
                    <th class="shiftboard-col-hour">18</th>
                    <th class="shiftboard-col-hour">19</th>
                    <th class="shiftboard-col-hour">20</th>
                    <th class="shiftboard-col-hour">21</th>
                    <th class="shiftboard-col-hour">22</th>
                    <th class="shiftboard-col-hour">23</th>
                    <th class="shiftboard-col-hour">0</th>
                    <th class="shiftboard-col-hour">1</th>
                    <th class="shiftboard-col-hour">2</th>
                    <th class="shiftboard-col-hour">3</th>
                    <th class="shiftboard-col-hour">4</th>
                    <th class="shiftboard-col-hour">5</th>
                    <th class="shiftboard-col-mh">M/H</th>
                    <th class="shiftboard-col-people">è¤‡å“¡äººæ•°</th>
                  </tr>
                </thead>
                <tbody id="shiftboardBody">
                  <!-- JSã§æç”» -->
                </tbody>
              </table>
            </div>

            <p class="hint" style="margin-top:8px;">
              â€» ä»Šã¯ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚ã‚ã¨ã§ã‚·ãƒ•ãƒˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚„AIã®ã‚·ãƒ•ãƒˆæ¡ˆã‹ã‚‰è‡ªå‹•ç”Ÿæˆã§ãã¾ã™ã€‚
            </p>
          </section>
        </section>

        <!-- â‘£ æ—§ï¼šã‚·ãƒ•ãƒˆè¡¨è¨­å®šï¼ˆç”»åƒURLæ–¹å¼ï¼‰ -->
        <section id="view-shift" class="view-panel">
          <section class="card" id="shift-card">
            <h2>ã‚·ãƒ•ãƒˆè¡¨è¨­å®š</h2>
            <p class="card-sub">
              ã‚¹ã‚¿ãƒƒãƒ•ç”»é¢ã‹ã‚‰ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã§é–‹ã‘ã‚‹ã€Œã‚·ãƒ•ãƒˆè¡¨ç”»åƒã€ã®URLã‚’è¨­å®šã—ã¾ã™ã€‚<br>
              ç”»åƒã¯ Googleãƒ‰ãƒ©ã‚¤ãƒ– / Gyazo / è‡ªåˆ†ã®ã‚µãƒ¼ãƒãƒ¼ãªã©ã«ã‚¢ãƒƒãƒ—ã—ã¦ã€å…¬é–‹URLã‚’è²¼ã‚Œã°OKã§ã™ã€‚
            </p>

            <!-- URL ç›´æ¥å…¥åŠ›æ¬„ -->
            <div class="row">
              <label for="shiftImageUrlInput">ã‚·ãƒ•ãƒˆè¡¨ç”»åƒURL</label>
              <input
                type="text"
                id="shiftImageUrlInput"
                placeholder="https:// ã‹ã‚‰å§‹ã¾ã‚‹ç”»åƒURLã‚’è²¼ã£ã¦ãã ã•ã„"
              />
              <div class="hint">
                URLã‚’ç›´æ¥è²¼ã£ã¦ã‚‚OKã§ã™ã€‚<br>
                ä¸‹ã®ã€Œç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã§é¸ã¶ã¨ã€è‡ªå‹•ã§ã“ã“ã«URLãŒå…¥ã‚Šã¾ã™ã€‚
              </div>
            </div>

            <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¬„ -->
            <div class="row">
              <label for="shiftImageFileInput">ã‚·ãƒ•ãƒˆè¡¨ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</label>
              <input
                type="file"
                id="shiftImageFileInput"
                accept="image/*"
              />
              <div class="hint">
                ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¶ã¨è‡ªå‹•ã§ Firebase Storage ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã€<br>
                URLæ¬„ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚
              </div>
            </div>

            <div class="btn-row">
              <button type="button" class="btn-primary" id="shiftImageUrlSaveBtn">
                ã“ã®å†…å®¹ã§ä¿å­˜
              </button>
            </div>
            <div class="status" id="shiftStatus"></div>

            <hr>

            <label>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</label>
            <img id="shiftImagePreview" src="" alt="ã‚·ãƒ•ãƒˆè¡¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">
          </section>
        </section>

        <!-- å¼•ãç¶™ããƒ¡ãƒ¢ -->
        <section id="view-handover" class="view-panel">
          <section class="card" id="handover-card">
            <h2>å¼•ãç¶™ããƒ¡ãƒ¢ï¼ˆãƒœã‚¿ãƒ³æ–‡è¨€ã®ç·¨é›†ï¼‰</h2>
            <p class="card-sub">
              ã‚¹ã‚¿ãƒƒãƒ•ç”»é¢ã®ã€Œå¼•ãç¶™ããƒ¡ãƒ¢ï¼ˆå…¨å“¡ã§å…±æœ‰ï¼‰ã€ã«ä¸¦ã‚“ã§ã„ã‚‹ãƒœã‚¿ãƒ³ã®æ–‡è¨€ã‚’ç·¨é›†ã§ãã¾ã™ã€‚<br>
              ä»Šã¯å…¨æ™‚é–“å¸¯ã§å…±é€šã®ãƒœã‚¿ãƒ³ã‚»ãƒƒãƒˆï¼ˆglobalï¼‰ã‚’ä½¿ã„ã¾ã™ã€‚
            </p>

            <div class="row">
              <label for="handoverChipsInput">ãƒœã‚¿ãƒ³æ–‡è¨€ãƒªã‚¹ãƒˆ</label>
              <textarea id="handoverChipsInput"
                placeholder="ä¾‹ï¼‰&#10;FFã‚±ãƒ¼ã‚¹æ¸…æƒæ¸ˆã¿&#10;ãƒ›ãƒƒãƒˆãƒ»å¸¸æ¸©FF è£œå……æ¸ˆã¿&#10;ç±³é£¯ãƒ»ãŠã«ãã‚Š å‰é™³ï¼†æ•´ç†æ¸ˆã¿"></textarea>
              <div class="hint">
                1è¡Œã«ã¤ã1ãƒœã‚¿ãƒ³ã«ãªã‚Šã¾ã™ã€‚ç©ºè¡Œã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚<br>
                ä¿å­˜ã™ã‚‹ã¨ã€å…¨ã¦ã®æ™‚é–“å¸¯ã®ã€Œå¼•ãç¶™ããƒ¡ãƒ¢ãƒœã‚¿ãƒ³ã€ãŒã“ã®å†…å®¹ã§ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚
              </div>
            </div>

            <div class="btn-row">
              <button type="button" class="btn-secondary" id="handoverReloadBtn">ç¾åœ¨ã®è¨­å®šã‚’èª­ã¿è¾¼ã¿</button>
              <button type="button" class="btn-primary" id="handoverSaveBtn">ã“ã®å†…å®¹ã§ä¿å­˜</button>
            </div>
            <div class="status" id="handoverStatus"></div>

            <hr>

            <label>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</label>
            <div class="handover-preview" id="handoverPreview"></div>

            <p class="hint" style="margin-top:6px;">
              â€»ã‚¹ã‚¿ãƒƒãƒ•ç”»é¢å´ã§ã¯ <code>handoverTemplates/global</code> ã®å†…å®¹ã‚’èª­ã¿ã«ã„ãã¾ã™ã€‚
            </p>
          </section>
        </section>

        <!-- ã‚¹ã‚¿ãƒƒãƒ•ãƒ­ã‚° -->
        <section id="view-logs" class="view-panel">
          <section class="card" id="logs-card">
            <h2>ã‚¹ã‚¿ãƒƒãƒ•ãƒ­ã‚°ï¼ˆchecklistLogsï¼‰</h2>
            <p class="card-sub">
              ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæ“ä½œã®å±¥æ­´ã‚’ç¢ºèªã§ãã¾ã™ã€‚<br>
              å–¶æ¥­æ—¥ã¨ç«¯æœ«ãƒ©ãƒ™ãƒ«ã§çµã‚Šè¾¼ã¿ã§ãã¾ã™ã€‚
            </p>

            <div class="log-filters">
              <div class="btn-row" style="margin-top:4px; margin-bottom:4px;">
                <button type="button" class="btn-secondary" id="logTodayBtn">ä»Šæ—¥</button>
                <button type="button" class="btn-secondary" id="logYesterdayBtn">æ˜¨æ—¥</button>
                <button type="button" class="btn-secondary" id="logLast3Btn">ç›´è¿‘3æ—¥ï¼ˆâ€»å®Ÿè£…äºˆå®šï¼‰</button>
              </div>

              <div class="field">
                <label for="logDate">å–¶æ¥­æ—¥</label>
                <input type="date" id="logDate">
              </div>

              <div class="field">
                <label for="logDevice">ç«¯æœ«ãƒ©ãƒ™ãƒ«ï¼ˆç©ºæ¬„ãªã‚‰å…¨ç«¯æœ«ï¼‰</label>
                <input type="text" id="logDevice" placeholder="ä¾‹ï¼šãƒ¬ã‚¸æ¨ªiPad">
              </div>

              <!-- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢æ¬„ -->
              <div class="field">
                <label for="logKeyword">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
                <input
                  type="text"
                  id="logKeyword"
                  placeholder="æ™‚åˆ» / å–¶æ¥­æ—¥ / ç«¯æœ« / æ“ä½œ / ã‚¿ã‚¹ã‚¯"
                >
              </div>

              <div class="field" style="flex:0 0 auto;">
                <button type="button" class="btn-primary" id="logFilterBtn">çµã‚Šè¾¼ã¿</button>
              </div>
            </div>

            <table class="log-table">
              <thead>
                <tr>
                  <th style="width:90px;">æ™‚åˆ»</th>
                  <th style="width:120px;">å–¶æ¥­æ—¥</th>
                  <th style="width:140px;">ç«¯æœ«</th>
                  <th style="width:70px;">æ“ä½œ</th>
                  <th>ã‚¿ã‚¹ã‚¯ / ãƒ¡ãƒ¢</th>
                </tr>
              </thead>
              <tbody id="logTableBody">
                <tr><td colspan="5">ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>
              </tbody>
            </table>
            <div class="log-empty" id="logEmptyMsg" style="display:none;"></div>

            <div class="status" id="logStatus"></div>
          </section>
        </section>

        <!-- ã‚°ãƒ©ãƒ•åˆ†æ -->
        <section id="view-analytics" class="view-panel">
          <section class="card" id="analytics-card">
            <h2>ã‚°ãƒ©ãƒ•åˆ†æï¼ˆÎ²ï¼‰</h2>
            <p class="card-sub">
              checklistLogs ã‹ã‚‰ã€å–¶æ¥­æ—¥ã”ã¨ã®ã€Œç«¯æœ«ã”ã¨ã®ãƒã‚§ãƒƒã‚¯å›æ•°ã€ã‚’ã–ã£ãã‚Šå¯è¦–åŒ–ã—ã¾ã™ã€‚<br>
              ã©ã®ç«¯æœ«ãŒã©ã‚Œãã‚‰ã„ã‚¿ã‚¹ã‚¯ã‚’é€²ã‚ã¦ã„ã‚‹ã‹ã®é›°å›²æ°—ã‚’è¦‹ã‚‹ç”¨ã®ç°¡æ˜“ç‰ˆã§ã™ã€‚
            </p>

            <div class="row analytics-controls">
              <div class="field">
                <label for="analyticsDate">å–¶æ¥­æ—¥</label>
                <input type="date" id="analyticsDate">
              </div>
              <div class="field" style="flex:0 0 auto;">
                <button type="button" class="btn-primary" id="analyticsRunBtn">
                  ã“ã®æ—¥ã§é›†è¨ˆ
                </button>
              </div>
            </div>

            <div class="summary-grid">
              <div class="summary-card">
                <div class="summary-title">åˆè¨ˆãƒã‚§ãƒƒã‚¯å›æ•°</div>
                <div class="summary-value" id="analyticsTotalCount">-</div>
                <div class="summary-note" id="analyticsSummaryNote"></div>
              </div>
            </div>

            <div class="analytics-chart-wrap">
              <canvas id="deviceChartCanvas" height="220"></canvas>
            </div>

            <h3 class="subsection-title">ç«¯æœ«ã”ã¨ã®å®Œäº†å›æ•°</h3>
            <table class="log-table analytics-table">
              <thead>
                <tr>
                  <th>ç«¯æœ«ãƒ©ãƒ™ãƒ«</th>
                  <th>å›æ•°</th>
                </tr>
              </thead>
              <tbody id="analyticsTableBody">
                <tr><td colspan="2">é›†è¨ˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</td></tr>
              </tbody>
            </table>

            <div class="log-empty" id="analyticsEmptyMsg" style="display:none;"></div>
            <div class="status" id="analyticsStatus"></div>
          </section>
        </section>

        <!-- ã‚·ãƒ•ãƒˆä½œæˆï¼ˆAIï¼‰ -->
        <section id="view-shiftai" class="view-panel">
          <div class="shiftai-layout">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <header class="shiftai-header">
              <div>
                <h1 class="shiftai-title">ã‚·ãƒ•ãƒˆä½œæˆï¼ˆAIè£œåŠ©ï¼‰</h1>
                <p class="shiftai-subtitle">
                  å¯¾è±¡æœŸé–“ã‚’é¸ã‚“ã§ã€ŒAIæœ€é©åŒ–ã€ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã“ã®ä¸‹ã«AIææ¡ˆã‚·ãƒ•ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
                </p>
              </div>
              <div class="shiftai-tag">Î²ç‰ˆ</div>
            </header>

            <!-- æ¡ä»¶å…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <section class="shiftai-card">
              <h2 class="shiftai-card-title">å¯¾è±¡æœŸé–“ã¨æ¡ä»¶</h2>

              <!-- æœŸé–“ã®ç¨®é¡ï¼šé€± / æœˆ -->
              <div class="shiftai-row">
                <div class="shiftai-label">å¯¾è±¡</div>
                <div class="shiftai-field">
                  <label class="shiftai-radio">
                    <input type="radio" name="shiftaiRangeType" value="week" checked>
                    <span>é€±å˜ä½</span>
                  </label>
                  <label class="shiftai-radio">
                    <input type="radio" name="shiftaiRangeType" value="month">
                    <span>æœˆå˜ä½</span>
                  </label>
                </div>
              </div>

              <!-- åŸºæº–æ—¥ / åŸºæº–æœˆ -->
              <div class="shiftai-row">
                <div class="shiftai-label">
                  <span data-shiftai-date-label>åŸºæº–æ—¥</span>
                </div>
                <div class="shiftai-field">
                  <input
                    type="date"
                    id="shiftaiBaseDate"
                    class="shiftai-date-input"
                  >
                  <p class="shiftai-help">
                    é€±ã®å ´åˆï¼šã“ã®æ—¥ã‚’å«ã‚€1é€±é–“ã‚’AIã§æœ€é©åŒ–ã—ã¾ã™ã€‚<br>
                    æœˆã®å ´åˆï¼šã“ã®æ—¥ãŒå±ã™ã‚‹æœˆã‚’AIã§æœ€é©åŒ–ã—ã¾ã™ã€‚
                  </p>
                </div>
              </div>

              <!-- AIãŒè€ƒãˆã‚‹ã¨ãã®å„ªå…ˆåº¦ï¼ˆä»Šã¯ãƒ€ãƒŸãƒ¼ï¼‰ -->
              <div class="shiftai-row">
                <div class="shiftai-label">AIã®å„ªå…ˆåº¦</div>
                <div class="shiftai-field shiftai-chips">
                  <label class="shiftai-chip">
                    <input type="checkbox" checked>
                    <span>å£²ä¸Šãƒ»å®¢æ•°ã‚’é‡è¦–</span>
                  </label>
                  <label class="shiftai-chip">
                    <input type="checkbox" checked>
                    <span>ã‚¹ã‚¿ãƒƒãƒ•ã®è² æ‹…ãƒãƒ©ãƒ³ã‚¹</span>
                  </label>
                  <label class="shiftai-chip">
                    <input type="checkbox">
                      <span>äººä»¶è²»ã‚’æŠ‘ãˆã‚‹</span>
                  </label>
                </div>
              </div>

              <!-- ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ -->
              <div class="shiftai-actions">
                <button id="shiftaiPrimaryBtn" class="shiftai-primary-btn">
                  <span id="shiftaiPrimaryBtnLabel">ã“ã®é€±ã‚’AIã§æœ€é©åŒ–</span>
                </button>
                <p class="shiftai-note">
                  ã¾ãšã¯ãƒ†ã‚¹ãƒˆç‰ˆã¨ã—ã¦ OpenAI ã‚’ç›´æ¥å‘¼ã³å‡ºã™äºˆå®šã§ã™ã€‚<br>
                  å®‰å®šã—ãŸã‚‰ Cloud Functions çµŒç”±ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚
                </p>
              </div>
            </section>

            <!-- AIã®çµæœãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <section class="shiftai-card">
              <h2 class="shiftai-card-title">AIã®ã‚·ãƒ•ãƒˆææ¡ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
              <p class="shiftai-empty" id="shiftaiPreviewEmpty">
                ã¾ã AIã¯å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä¸Šã®ã€ŒAIæœ€é©åŒ–ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€
                ã“ã“ã« <strong>1é€±é–“ or 1ãƒ¶æœˆåˆ†ã®ã‚·ãƒ•ãƒˆæ¡ˆ</strong> ãŒã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
              </p>

              <div id="shiftaiPreviewArea" class="shiftai-preview-area">
                <!-- ã“ã“ã«AIçµæœã‚’æç”» -->
              </div>
            </section>
          </div>
        </section>
      </main>
    </div>
  </div>


  <!-- Chart.jsï¼ˆã‚°ãƒ©ãƒ•ç”¨ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage-compat.js"></script>

  <script>
    // =============================
    // 0) ã‚ªãƒ¼ãƒŠãƒ¼ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‹15æ™‚é–“åˆ¶é™ï¼‰
    // =============================
    (function () {
      // â˜…ã“ã“ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ›¸ãï¼ˆå¥½ããªæ–‡å­—åˆ—ã«å¤‰ãˆã¦OKï¼‰
      const OWNER_PASSWORD = "nanbu";

      const SESSION_LIMIT_MS = 15 * 60 * 60 * 1000; // 15æ™‚é–“
      const SESSION_KEY = "lw_ownerSession";

      function isSessionValid() {
        const raw = localStorage.getItem(SESSION_KEY);
        if (!raw) return false;
        try {
          const data = JSON.parse(raw);
          if (!data || !data.loggedAt) return false;
          const loggedAt = data.loggedAt;
          const now = Date.now();
          return now - loggedAt < SESSION_LIMIT_MS;
        } catch (e) {
          return false;
        }
      }

      function saveSession() {
        const payload = {
          loggedAt: Date.now()
        };
        localStorage.setItem(SESSION_KEY, JSON.stringify(payload));
      }

            window.addEventListener("DOMContentLoaded", () => {
        const loginWrap = document.getElementById("ownerLogin");
        const appWrap = document.getElementById("ownerApp");
        const pwdInput = document.getElementById("ownerPasswordInput");
        const loginBtn = document.getElementById("ownerLoginBtn");
        const errorLabel = document.getElementById("ownerLoginError");
        const storeIdInput = document.getElementById("storeIdInput");

        if (!loginWrap || !appWrap || !pwdInput || !loginBtn) return;

        function showApp() {
          loginWrap.style.display = "none";
          appWrap.style.display = "block";
        }

        function showLogin() {
          loginWrap.style.display = "block";
          appWrap.style.display = "none";
        }

        // ã™ã§ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹ãªã‚‰ã€ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚¹ã‚­ãƒƒãƒ—
        const currentStoreId = localStorage.getItem("lw_ownerStoreId");
        if (currentStoreId && ALLOWED_STORES.includes(currentStoreId) && isSessionValid()) {
          // ã¤ã„ã§ã«å…¥åŠ›æ¬„ã‚‚åŸ‹ã‚ã¦ãŠã
          if (storeIdInput) storeIdInput.value = currentStoreId;
          showApp();
        } else {
          showLogin();
        }

        function tryLogin() {
          const pwd = pwdInput.value.trim();
          const storeId = storeIdInput.value.trim();

          if (!storeId) {
            errorLabel.textContent = "åº—èˆ—IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
            return;
          }
          if (!ALLOWED_STORES.includes(storeId)) {
            errorLabel.textContent = "åº—èˆ—IDãŒé•ã„ã¾ã™ã€‚";
            return;
          }

          if (!pwd) {
            errorLabel.textContent = "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
            return;
          }

          if (pwd === OWNER_PASSWORD) {
            // åº—èˆ—IDã‚’ä¿å­˜
            localStorage.setItem("lw_ownerStoreId", storeId);

            saveSession();
            errorLabel.textContent = "";

            // â˜… storeId ã‚’åæ˜ ã•ã›ã‚‹ãŸã‚ã«ãƒšãƒ¼ã‚¸ã”ã¨å†èª­ã¿è¾¼ã¿
            location.reload();
          } else {
            errorLabel.textContent = "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚";
          }
        }

        loginBtn.addEventListener("click", tryLogin);
        pwdInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            tryLogin();
          }
        });
      });
    })();


    // =============================
    // Firebase è¨­å®š
    // =============================
    const firebaseConfig = {
      apiKey: "AIzaSyAPBMvTpzKCcPxLETncBqVR8fzf0cqKirc",
      authDomain: "lawson-workflow.firebaseapp.com",
      projectId: "lawson-workflow",
      storageBucket: "lawson-workflow.firebasestorage.app",
      messagingSenderId: "335371795694",
      appId: "1:335371795694:web:3b0950a616d368b284c7ff",
      measurementId: "G-BGENZNZMRC"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();



    

// â˜… åº—èˆ—IDï¼ˆstoreIdï¼‰ã¯ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§ localStorage ã«ä¿å­˜ã—ã¦ãŠãæƒ³å®š
const ALLOWED_STORES = ["nambucho"];               // è¨±å¯ã™ã‚‹åº—èˆ—ID
const STORE_KEY = "lw_ownerStoreId";

// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰åº—èˆ—IDã‚’å–å¾—
const STORE_ID = localStorage.getItem(STORE_KEY);

// æœ‰åŠ¹ãªåº—èˆ—IDã®ã¨ãã ã‘ storeRef ã‚’ä½œã‚‹
let storeRef = null;
if (STORE_ID && ALLOWED_STORES.includes(STORE_ID)) {
  storeRef = db.collection("stores").doc(STORE_ID);
}


    // 6:00åˆ‡ã‚Šæ›¿ãˆã®ã€Œä»Šæ—¥ã®å–¶æ¥­æ—¥ã€
    function getCurrentBusinessKey() {
      const now = new Date();
      const y = now.getFullYear();
      const m = now.getMonth();
      const d = now.getDate();
      const base = new Date(y, m, d);
      if (now.getHours() < 7) {
        base.setDate(base.getDate() - 1);
      }
      const yy = base.getFullYear();
      const mm = String(base.getMonth() + 1).padStart(2, "0");
      const dd = String(base.getDate()).padStart(2, "0");
      return `${yy}-${mm}-${dd}`;
    }

    // date input ã®å€¤ï¼ˆYYYY-MM-DDï¼‰ â†’ businessKey
    function businessKeyFromDateInput(dateStr) {
      if (!dateStr) return null;
      return dateStr;
    }

    document.addEventListener("DOMContentLoaded", () => {
  // =============================
  // AIæœ€é©åŒ–ï¼ˆCloud Functions çµŒç”±ç‰ˆï¼‰
  // =============================
  const aiBtn = document.getElementById("aiOptimizeBtn");
  const shiftaiPrimaryBtn = document.getElementById("shiftaiPrimaryBtn");
  const shiftaiPreviewArea = document.getElementById("shiftaiPreviewArea");
  const shiftaiPreviewEmpty = document.getElementById("shiftaiPreviewEmpty");
  const shiftaiBaseDateInput = document.getElementById("shiftaiBaseDate");

  // â˜… Firebase Functions ã® URLï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å‡ºã¦ãŸã‚„ã¤ï¼‰
  const AI_FUNCTION_URL =
    "https://us-central1-lawson-workflow.cloudfunctions.net/generateShift";

  async function runShiftAiTest() {
    if (!shiftaiPreviewArea || !shiftaiPrimaryBtn) return;

    const oldLabel = shiftaiPrimaryBtn.textContent;
    shiftaiPrimaryBtn.disabled = true;
    shiftaiPrimaryBtn.textContent = "AIã«å•ã„åˆã‚ã›ä¸­â€¦";

    try {
      // é€± / æœˆ & åŸºæº–æ—¥
      const checked = document.querySelector(
        'input[name="shiftaiRangeType"]:checked'
      );
      const mode = checked ? checked.value : "week";
      const baseDate = shiftaiBaseDateInput.value || getCurrentBusinessKey();

      // â˜… ã¾ãšã¯ãƒ†ã‚¹ãƒˆç”¨ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¥­ç¨®å…±é€šã®ã‚µãƒ³ãƒ—ãƒ«ï¼‰
      //   â†’ ã‚ã¨ã§ Firestore ã‹ã‚‰ staff / requiredSlots ã‚’èª­ã‚€å½¢ã«å·®ã—æ›¿ãˆã‚‹
      const payload = {
        targetDate: baseDate,               // Cloud Functions å´ã® targetDate
        storeId: STORE_ID || "test-store",  // Cloud Functions å´ã® storeId

        // æ±ç”¨ã‚¹ã‚¿ãƒƒãƒ•ï¼ˆã©ã®æ¥­ç¨®ã§ã‚‚é•å’Œæ„Ÿãªã„ã‚µãƒ³ãƒ—ãƒ«ï¼‰
        staff: [
          {
            id: "staff001",
            name: "ã‚¹ã‚¿ãƒƒãƒ•A",
            roles: ["åŸºæœ¬æ¥­å‹™"],
            maxHoursPerWeek: 28,
            canNight: true,
          },
          {
            id: "staff002",
            name: "ã‚¹ã‚¿ãƒƒãƒ•B",
            roles: ["åŸºæœ¬æ¥­å‹™"],
            maxHoursPerWeek: 20,
            canNight: false,
          },
          {
            id: "staff003",
            name: "ã‚¹ã‚¿ãƒƒãƒ•C",
            roles: ["åŸºæœ¬æ¥­å‹™", "ã‚µãƒãƒ¼ãƒˆæ¥­å‹™"],
            maxHoursPerWeek: 24,
            canNight: true,
          },
        ],

        // æ±ç”¨æ™‚é–“å¸¯ï¼ˆ9ã€œ18æ™‚ã®æ˜¼ãƒ¡ã‚¤ãƒ³æ¥­ç¨®ã§ã‚‚ä½¿ãˆã‚‹æ„Ÿã˜ï¼‰
        requiredSlots: [
          { timeRange: "09:00-12:00", minStaff: 1 },
          { timeRange: "12:00-15:00", minStaff: 2 },
          { timeRange: "15:00-18:00", minStaff: 2 },
        ],
      };

      console.log("ğŸ”¥ Cloud Functions ã«é€ã‚‹ãƒ‡ãƒ¼ã‚¿:", payload);

      const res = await fetch(AI_FUNCTION_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(payload),
      });

      if (!res.ok) {
        const text = await res.text();
        throw new Error("generateShift ã‚¨ãƒ©ãƒ¼: " + text);
      }

      const data = await res.json();
      console.log("âœ… generateShift å¿œç­”:", data);

      // ---- ç”»é¢ã«è¡¨ç¤ºï¼ˆã¨ã‚Šã‚ãˆãš JSON ã‚’ãã®ã¾ã¾è¡¨ç¤ºï¼‰----
      if (shiftaiPreviewEmpty) {
        shiftaiPreviewEmpty.style.display = "none";
      }
      shiftaiPreviewArea.innerHTML = "";

      const card = document.createElement("div");
      card.style.whiteSpace = "pre-wrap";
      card.style.fontSize = "12px";
      card.textContent = JSON.stringify(data, null, 2);

      shiftaiPreviewArea.appendChild(card);
    } catch (err) {
      console.error(err);
      alert("AIå‘¼ã³å‡ºã—ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¾ã—ãŸ: " + (err.message || err));
    } finally {
      shiftaiPrimaryBtn.disabled = false;
      shiftaiPrimaryBtn.textContent = oldLabel;
    }
  }

  // ãƒ¡ã‚¤ãƒ³ã®ãƒœã‚¿ãƒ³ã«ç´ã¥ã‘
  if (shiftaiPrimaryBtn) {
    shiftaiPrimaryBtn.addEventListener("click", (e) => {
      e.preventDefault();
      runShiftAiTest();
    });
  }

  // å³ä¸Šã®é»’ã„ã€ŒAIæœ€é©åŒ–ã€ãƒœã‚¿ãƒ³ â†’ åŒã˜å‡¦ç†ã‚’å©ã
  if (aiBtn) {
    aiBtn.addEventListener("click", (e) => {
      e.preventDefault();
      runShiftAiTest();
    });
  }


  // storeId ãŒã¾ã è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€Firestoreç³»ã®åˆæœŸåŒ–ã¯ã‚¹ã‚­ãƒƒãƒ—
  if (!storeRef) {
    console.warn("STORE_ID ãŒæœªè¨­å®šã®ãŸã‚ã€Firestoreã®å‡¦ç†ã¯ã¾ã å®Ÿè¡Œã—ã¾ã›ã‚“ã€‚ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  // =============================
  // ã‚·ãƒ•ãƒˆAIãƒ“ãƒ¥ãƒ¼ç”¨ã®UIåˆ¶å¾¡ï¼ˆé€± / æœˆåˆ‡ã‚Šæ›¿ãˆï¼‰
  // =============================
  (function () {
    const rangeRadios = document.querySelectorAll('input[name="shiftaiRangeType"]');
    const dateInput = document.getElementById("shiftaiBaseDate");
    const dateLabel = document.querySelector("[data-shiftai-date-label]");
    const primaryBtnLabel = document.getElementById("shiftaiPrimaryBtnLabel");

    if (!rangeRadios.length || !dateInput || !dateLabel || !primaryBtnLabel) {
      return; // ã¾ã  shiftai ãƒ“ãƒ¥ãƒ¼ã‚’ä½œã£ã¦ã„ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
    }

    // åˆæœŸå€¤ï¼šä»Šæ—¥ã®å–¶æ¥­æ—¥ã‚’åŸºæº–æ—¥ã«ã‚»ãƒƒãƒˆ
    if (!dateInput.value) {
      dateInput.value = getCurrentBusinessKey(); // "YYYY-MM-DD"
    }

    function updateUI() {
      const checked = document.querySelector('input[name="shiftaiRangeType"]:checked');
      const mode = checked ? checked.value : "week";

      if (mode === "week") {
        dateLabel.textContent = "åŸºæº–æ—¥";
        primaryBtnLabel.textContent = "ã“ã®é€±ã‚’AIã§æœ€é©åŒ–";
      } else {
        dateLabel.textContent = "åŸºæº–æœˆ";
        primaryBtnLabel.textContent = "ã“ã®æœˆã‚’AIã§æœ€é©åŒ–";
      }
    }

    rangeRadios.forEach((r) => {
      r.addEventListener("change", updateUI);
    });

    updateUI();
  })();


      // =============================
      // ã‚ªãƒ¼ãƒŠãƒ¼ID / ç«¯æœ«åã®ä¿å­˜ï¼†è‡ªå‹•ã‚»ãƒƒãƒˆ
      // =============================
      (function () {
        const OWNER_ID_KEY = "lw_ownerOwnerId";
        const ownerIdInput = document.getElementById("ownerIdInput");
        if (!ownerIdInput) return;

        const savedOwnerId = localStorage.getItem(OWNER_ID_KEY);
        if (savedOwnerId) {
          ownerIdInput.value = savedOwnerId;
        }

        ownerIdInput.addEventListener("change", () => {
          const value = ownerIdInput.value.trim();
          if (value) {
            localStorage.setItem(OWNER_ID_KEY, value);
          }
        });
      })();

      // =============================
      // ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹é–‰
      // =============================
      const sidebar = document.querySelector(".sidebar");
      const sidebarOverlay = document.getElementById("sidebarOverlay");
      const mobileMenuBtn = document.getElementById("mobileMenuBtn");

      function closeSidebar() {
        if (!sidebar) return;
        sidebar.classList.remove("mobile-open");
        if (sidebarOverlay) sidebarOverlay.classList.remove("active");
      }

      function openSidebar() {
        if (!sidebar) return;
        sidebar.classList.add("mobile-open");
        if (sidebarOverlay) sidebarOverlay.classList.add("active");
      }

      mobileMenuBtn?.addEventListener("click", () => {
        if (sidebar.classList.contains("mobile-open")) {
          closeSidebar();
        } else {
          openSidebar();
        }
      });

      sidebarOverlay?.addEventListener("click", closeSidebar);

     // =============================
// å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
// =============================
const navButtons = document.querySelectorAll(".sidebar-nav button");
const views = document.querySelectorAll(".view-panel");

// Analytics ç”¨å‚ç…§ï¼ˆactivateView å†…ã§ä½¿ã†ã®ã§å…ˆã«å®£è¨€ã ã‘ï¼‰
let runAnalyticsRef = null;
let analyticsDateInputRef = null;

function activateView(viewId) {
  // ãƒ“ãƒ¥ãƒ¼ãƒ‘ãƒãƒ«ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
  views.forEach((v) =>
    v.classList.toggle("active", v.id === "view-" + viewId)
  );

  // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã® active åˆ‡ã‚Šæ›¿ãˆ
  navButtons.forEach((btn) =>
    btn.classList.toggle("active", btn.dataset.view === viewId)
  );

  // ã‚·ãƒ•ãƒˆè¡¨ã‚¿ãƒ–ãŒé–‹ã‹ã‚ŒãŸã‚‰ç¾åœ¨è¨­å®šã‚’èª­ã¿è¾¼ã‚€
  if (viewId === "shift") {
    loadShiftImageSetting();
  }

  // ã‚°ãƒ©ãƒ•åˆ†æã‚¿ãƒ–ãŒé–‹ã‹ã‚ŒãŸã‚‰è‡ªå‹•ã§é›†è¨ˆï¼ˆåˆå›ï¼‰
  if (viewId === "analytics" && runAnalyticsRef) {
    if (analyticsDateInputRef && !analyticsDateInputRef.value) {
      analyticsDateInputRef.value = getCurrentBusinessKey();
    }
    runAnalyticsRef();
  }

 // â˜… AIãƒœã‚¿ãƒ³åˆ¶å¾¡ï¼ˆã“ã“ã‚’è¿½åŠ ï¼‰
  const aiBtn = document.getElementById("aiOptimizeBtn");
  if (aiBtn) {
    if (viewId === "shiftai") {
      aiBtn.style.display = "block";
    } else {
      aiBtn.style.display = "none";
    }
  }
  
}

// å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä»˜ä¸
navButtons.forEach((btn) => {
  btn.addEventListener("click", () => {
    const viewId = btn.dataset.view;

    // â˜… ãŠçŸ¥ã‚‰ã›ã‚»ãƒ³ã‚¿ãƒ¼ã ã‘ã¯åˆ¥ã‚¿ãƒ–ã§ notice.html ã‚’é–‹ã
    if (viewId === "notice-center") {
      window.open("notice.html", "_blank"); // åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹æƒ³å®š
      closeSidebar();                       // ã‚¹ãƒãƒ›ãªã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‰ã˜ã‚‹
      return;                               // ã“ã“ã§çµ‚äº†
    }

    // ãã‚Œä»¥å¤–ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯æ™®é€šã«ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
    activateView(viewId);
    closeSidebar();
  });
});

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šãŠçŸ¥ã‚‰ã›ç®¡ç†ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
activateView("news");


      // =============================
      // 1) ownerNews ï¼ˆãŠçŸ¥ã‚‰ã›ç®¡ç†ï¼‰
      // =============================
      const newsTitleInput = document.getElementById("newsTitle");
      const newsBodyInput = document.getElementById("newsBody");
      const newsAddBtn = document.getElementById("newsAddBtn");
      const newsClearBtn = document.getElementById("newsClearFormBtn");
      const newsStatus = document.getElementById("newsStatus");
      const newsList = document.getElementById("newsList");
      const ownerNewsColRef = storeRef.collection("ownerNews");

      function setNewsStatus(msg, ok) {
  newsStatus.textContent = msg || "";
  newsStatus.className = "status " + (ok ? "ok" : "err");
}


      newsAddBtn.addEventListener("click", async () => {
        const title = newsTitleInput.value.trim();
        const body = newsBodyInput.value.trim();
        if (!title && !body) {
          setNewsStatus("ã‚¿ã‚¤ãƒˆãƒ«ã‹æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚", false);
          return;
        }
        setNewsStatus("ä¿å­˜ä¸­â€¦", true);
        try {
          await ownerNewsColRef.add({
            title,
            body,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          setNewsStatus("ãŠçŸ¥ã‚‰ã›ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚", true);
          newsTitleInput.value = "";
          newsBodyInput.value = "";
        } catch (e) {
          console.error(e);
          setNewsStatus("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", false);
        }
      });

      newsClearBtn.addEventListener("click", () => {
        newsTitleInput.value = "";
        newsBodyInput.value = "";
        setNewsStatus("", true);
      });

      ownerNewsColRef
        .orderBy("createdAt", "desc")
        .limit(20)
        .onSnapshot(
          (snapshot) => {
            newsList.innerHTML = "";
            if (snapshot.empty) {
              const li = document.createElement("li");
              li.textContent = "ç¾åœ¨ã€ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
              newsList.appendChild(li);
              return;
            }
            snapshot.forEach((doc) => {
              const data = doc.data();
              const li = document.createElement("li");
              li.className = "news-item";

              const main = document.createElement("div");
              main.className = "news-main";

              const titleEl = document.createElement("div");
              titleEl.className = "news-title";
              titleEl.textContent = data.title || "(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)";

              const bodyEl = document.createElement("div");
              bodyEl.className = "news-body";
              bodyEl.textContent = data.body || "";

              const metaEl = document.createElement("div");
              metaEl.className = "news-meta";
              const createdAt = data.createdAt ? data.createdAt.toDate() : null;
              metaEl.textContent = createdAt
                ? createdAt.toLocaleString("ja-JP")
                : "æ—¥æ™‚æƒ…å ±ãªã—";

              main.appendChild(titleEl);
              main.appendChild(bodyEl);
              main.appendChild(metaEl);

              const actions = document.createElement("div");
              actions.className = "news-actions";
              const delBtn = document.createElement("button");
              delBtn.className = "btn-danger";
              delBtn.textContent = "å‰Šé™¤";
              delBtn.addEventListener("click", async () => {
                if (!confirm("ã“ã®ãŠçŸ¥ã‚‰ã›ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
                await doc.ref.delete();
              });
              actions.appendChild(delBtn);

              li.appendChild(main);
              li.appendChild(actions);

              newsList.appendChild(li);
            });
          },
          (error) => {
            console.error("ownerNews èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼", error);
            newsList.innerHTML = "";
            const li = document.createElement("li");
            li.textContent = "ãŠçŸ¥ã‚‰ã›ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
            newsList.appendChild(li);
          }
        );

            // =============================
      // 2) taskSlotsï¼ˆæ™‚é–“å¸¯ã”ã¨ã®ã‚¿ã‚¹ã‚¯å®šç¾©ï¼‰
      // =============================
      const slotSelect = document.getElementById("slotSelect");
      const tasksAInput = document.getElementById("tasksAInput");
      const tasksBInput = document.getElementById("tasksBInput");
      const reloadSlotBtn = document.getElementById("reloadSlotBtn");
      const saveSlotBtn = document.getElementById("saveSlotBtn");
      const taskStatus = document.getElementById("taskStatus");
      const taskSlotsRef = storeRef.collection("taskSlots");
      const tasksDocRef  = storeRef.collection("tasks").doc("main"); // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆç”¨

      // â˜… æ™‚é–“å¸¯è¨­å®š UI è¦ç´ 
      const slotConfigStartInput = document.getElementById("slotConfigStart");
      const slotConfigEndInput = document.getElementById("slotConfigEnd");
      const slotConfigIntervalSelect = document.getElementById("slotConfigInterval");
      const slotConfigGenerateBtn = document.getElementById("slotConfigGenerateBtn");

      // Firestore ä¸Šã®æ™‚é–“å¸¯è¨­å®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
      const timeSlotsConfigRef = storeRef.collection("settings").doc("timeSlots");

      // â˜… ã‚«ã‚¹ã‚¿ãƒ æ™‚é–“å¸¯ãƒ†ã‚­ã‚¹ãƒˆç”¨ã®è¦ç´ 
      const slotCustomInput     = document.getElementById("slotCustomInput");
      const slotCustomLoadBtn   = document.getElementById("slotCustomLoadBtn");
      const slotCustomSaveBtn   = document.getElementById("slotCustomSaveBtn");

      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ™‚é–“å¸¯ãƒªã‚¹ãƒˆï¼ˆã„ã¾ã¾ã§ã¨åŒã˜ï¼‰
      function getDefaultSlots() {
        return [
          { id: "t6-8",   label: "6:00ã€œ8:00ï¼ˆæœã®ç«‹ã¡ä¸Šã’ï¼‰" },
          { id: "t9-11",  label: "9:00ã€œ11:00ï¼ˆåˆå‰å¸¯ï¼‰" },
          { id: "t12-14", label: "12:00ã€œ14:00ï¼ˆæ˜¼å¸¯ï¼‰" },
          { id: "t15-17", label: "15:00ã€œ17:00ï¼ˆå¤•æ–¹å‰ï¼‰" },
          { id: "t18-20", label: "18:00ã€œ20:00ï¼ˆå¤•æ–¹ã€œå¤œï¼‰" },
          { id: "t21-23", label: "21:00ã€œ23:00ï¼ˆå¤œå¸¯ï¼‰" },
          { id: "t0-2",   label: "0:00ã€œ2:00ï¼ˆæ·±å¤œå‰åŠï¼‰" },
          { id: "t3-5",   label: "3:00ã€œ5:00ï¼ˆæ—©æœï¼‰" }
        ];
      }

      // â˜… ç¾åœ¨ã® slots ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚­ã‚¹ãƒˆã«åæ˜ 
      function updateSlotCustomTextarea(slots) {
        if (!slotCustomInput) return;
        const text = (slots && slots.length > 0)
          ? slots.map((s) => s._raw || s.label || s.id).join("\n")
          : "";
        slotCustomInput.value = text;
      }

      // slotSelect ã® option ã‚’ä½œã‚Šç›´ã™
      function renderSlotOptions(slots, initialLoad) {
  slotSelect.innerHTML = "";
  if (!slots || slots.length === 0) {
    slots = getDefaultSlots();
  }

  slots.forEach((s) => {
    const opt = document.createElement("option");
    opt.value = s.id;

    let text = "";

    // â˜… ã‚«ã‚¹ã‚¿ãƒ ç·¨é›†ã§å…¥åŠ›ã—ãŸè¡Œã«ã¯ _raw ãŒå…¥ã£ã¦ã„ã‚‹
    // ä¾‹: "06:00-09:00 æœã®ç«‹ã¡ä¸Šã’"
    if (s._raw && typeof s._raw === "string") {
      // å…ˆé ­ã®æ™‚é–“éƒ¨åˆ†ã¨ãƒ©ãƒ™ãƒ«éƒ¨åˆ†ã«åˆ†å‰²
      const parts = s._raw.split(/\s+/, 2);
      const rangePart = parts[0];          // "06:00-09:00"
      const labelPart = parts[1] || "";    // "æœã®ç«‹ã¡ä¸Šã’"ï¼ˆãªã„å ´åˆã‚‚ã‚ã‚Šï¼‰

      // 06:00-09:00 â†’ 06:00ã€œ09:00 ã«ã—ã¦ã‹ã‚‰çµåˆ
      const rangeNice = rangePart.replace("-", "ã€œ");
      text = labelPart ? `${rangeNice} ${labelPart}` : rangeNice;
    } else {
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¹ãƒ­ãƒƒãƒˆï¼ˆlabel ã«æ™‚é–“ã‚‚å…¥ã£ã¦ã„ã‚‹ã‚„ã¤ï¼‰ã¯ãã®ã¾ã¾
      text = s.label || s.id;
    }

    opt.textContent = text;
    slotSelect.appendChild(opt);
  });

  // 1å€‹ç›®ã‚’é¸æŠ
  if (!slotSelect.value && slots[0]) {
    slotSelect.value = slots[0].id;
  }

  // é¸æŠã•ã‚ŒãŸæ™‚é–“å¸¯ã®å®šç¾©ã‚’èª­ã¿è¾¼ã‚€
  if (slotSelect.value) {
    loadSlotDefinition(slotSelect.value);
  }
}


      // Firestore ã‹ã‚‰æ™‚é–“å¸¯è¨­å®šã‚’èª­ã¿è¾¼ã¿
      async function loadTimeSlotsConfig(initialLoad) {
        try {
          const snap = await timeSlotsConfigRef.get();
          if (!snap.exists) {
            // ã¾ã è¨­å®šãªã„ â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æç”»
            const defaults = getDefaultSlots();
            updateSlotCustomTextarea(defaults);
            renderSlotOptions(defaults, initialLoad);
            return;
          }
          const data = snap.data() || {};
          const slots = Array.isArray(data.slots) ? data.slots : getDefaultSlots();

          // UI å´ã« start/end/interval åæ˜ 
          if (slotConfigStartInput && data.start) {
            slotConfigStartInput.value = data.start;
          }
          if (slotConfigEndInput && data.end) {
            slotConfigEndInput.value = data.end;
          }
          if (slotConfigIntervalSelect && data.intervalMinutes) {
            const val = String(data.intervalMinutes);
            const has = Array.from(slotConfigIntervalSelect.options).some(
              (opt) => opt.value === val
            );
            if (has) slotConfigIntervalSelect.value = val;
          }

          // â˜… textarea ã«ã‚‚åæ˜ 
          updateSlotCustomTextarea(slots);
          renderSlotOptions(slots, initialLoad);
        } catch (e) {
          console.error("timeSlotsConfig èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼", e);
          const defaults = getDefaultSlots();
          updateSlotCustomTextarea(defaults);
          renderSlotOptions(defaults, initialLoad);
        }
      }

            // æ™‚åˆ»æ–‡å­—åˆ— "HH:MM" â†’ åˆ†ï¼ˆ0ã€œï¼‰ã«å¤‰æ›
      function parseTimeToMinutes(hm) {
        const [hStr, mStr] = hm.split(":");
        const h = parseInt(hStr, 10);
        const m = parseInt(mStr, 10);
        if (
          Number.isNaN(h) ||
          Number.isNaN(m) ||
          h < 0 || h > 24 ||
          m < 0 || m >= 60
        ) {
          return null;
        }
        return (h * 60 + m) % (24 * 60); // 0ã€œ1439 ã«ä¸¸ã‚ã‚‹
      }

      // åˆ†ï¼ˆ0ã€œï¼‰ â†’ "HH:MM" ã«å¤‰æ›
      function formatMinutesToTime(total) {
        const t = ((total % (24 * 60)) + (24 * 60)) % (24 * 60);
        const h = String(Math.floor(t / 60)).padStart(2, "0");
        const m = String(t % 60).padStart(2, "0");
        return `${h}:${m}`;
      }

      // å…¥åŠ›å€¤ã‹ã‚‰æ™‚é–“å¸¯ã‚¹ãƒ­ãƒƒãƒˆã‚’è‡ªå‹•ç”Ÿæˆï¼ˆé–‹å§‹ã€œçµ‚äº†ï¼‹åŒºåˆ‡ã‚Šãƒ»åˆ†ãƒ™ãƒ¼ã‚¹ï¼‰
      function generateSlotsFromInputs() {
        if (!slotConfigStartInput || !slotConfigEndInput || !slotConfigIntervalSelect) {
          return null;
        }

        const startStr = slotConfigStartInput.value || "06:00";
        const endStr   = slotConfigEndInput.value   || "23:00";
        const intervalMinutes =
          parseInt(slotConfigIntervalSelect.value, 10) || 60; // 15 / 30 / 60 / 120...

        const startMin = parseTimeToMinutes(startStr);
        const endMin   = parseTimeToMinutes(endStr);

        if (startMin === null || endMin === null) {
          alert("æ™‚é–“ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆä¾‹: 06:00ï¼‰");
          return null;
        }
        if (!intervalMinutes || intervalMinutes <= 0) {
          alert("åŒºåˆ‡ã‚Šæ™‚é–“ï¼ˆåˆ†ï¼‰ãŒä¸æ­£ã§ã™");
          return null;
        }

        // 1æ—¥ã‚’ã¾ãŸãå ´åˆï¼ˆçµ‚äº† <= é–‹å§‹ ã®ã¨ãã¯ç¿Œæ—¥æ‰±ã„ï¼‰
        let rangeEnd = endMin;
        if (rangeEnd <= startMin) {
          rangeEnd += 24 * 60;
        }

        const slots = [];
        let cur = startMin;
        let index = 0;
        const MAX_SLOTS = 96; // 15åˆ†åˆ»ã¿ã§æœ€å¤§ 24h

        while (cur < rangeEnd && index < MAX_SLOTS) {
          const next = Math.min(cur + intervalMinutes, rangeEnd);

          const sLabel = formatMinutesToTime(cur);   // ä¾‹: "06:00"
          const eLabel = formatMinutesToTime(next);  // ä¾‹: "06:30"
          const label  = `${sLabel}ã€œ${eLabel}`;

          // slotId ã¯ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚‰ä½•ã§ã‚‚OKï¼ˆindex.html å´ã‚‚ prefix ã¨ã—ã¦ä½¿ã†ã ã‘ï¼‰
          const id = `slot_${sLabel.replace(":", "")}_${eLabel.replace(":", "")}`;

          slots.push({
            id,
            label,
            start: sLabel,
            end: eLabel,
            order: index
          });

          cur = next;
          index++;
        }

        return {
          slots,
          start: startStr,
          end:   endStr,
          intervalMinutes
        };
      }

      // â˜… ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ slots é…åˆ—ã‚’ä½œã‚‹
      function parseCustomSlotsFromTextarea() {
        if (!slotCustomInput) return null;

        const lines = slotCustomInput.value.split("\n");
        const slots = [];
        let lineNo = 0;
        let hasMinuteError = false;

        for (const rawLine of lines) {
          lineNo++;
          const line = rawLine.trim();
          if (!line) continue;

          // æœ€åˆã®ç©ºç™½ã¾ã§ãŒæ™‚é–“ãƒ¬ãƒ³ã‚¸ã€ãã‚Œä»¥é™ãŒãƒ©ãƒ™ãƒ«
          const parts = line.split(/\s+/);
          const rangePart = parts[0];
          const labelRest = parts.slice(1).join(" ");

          const rangeSplit = rangePart.split("-");
          if (rangeSplit.length !== 2) {
            alert(`è¡Œ${lineNo}ï¼šã€Œ${line}ã€ã®æ™‚é–“ã®æ›¸å¼ãŒä¸æ­£ã§ã™ã€‚ä¾‹ï¼‰06:00-09:00 ã®ã‚ˆã†ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚`);
            return null;
          }

          function parseTime(str) {
            const [hStr, mStr] = str.split(":");
            const h = Number(hStr);
            const m = mStr !== undefined ? Number(mStr) : 0;
            if (
              Number.isNaN(h) ||
              Number.isNaN(m) ||
              h < 0 ||
              h > 24 ||
              m < 0 ||
              m >= 60
            ) {
              return null;
            }
            if (m !== 0) {
              hasMinuteError = true;
            }
            return { hour: h % 24, minute: m };
          }

          const start = parseTime(rangeSplit[0]);
          const end   = parseTime(rangeSplit[1]);
          if (!start || !end) {
            alert(`è¡Œ${lineNo}ï¼šã€Œ${line}ã€ã®æ™‚é–“ãŒèª­ã¿å–ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ä¾‹ï¼‰06:00-09:00 ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚`);
            return null;
          }

          const h1 = start.hour;
          const h2 = end.hour;

          const id = `t${h1}-${h2}`;
          const label =
            labelRest && labelRest.trim().length > 0
              ? labelRest.trim()
              : `${String(h1).padStart(2, "0")}:00ã€œ${String(h2).padStart(2, "0")}:00`;

          slots.push({
            id,
            label,
            _raw: `${String(h1).padStart(2, "0")}:00-${String(h2).padStart(2, "0")}:00 ${label}`
          });
        }

        if (slots.length === 0) {
          alert("æœ‰åŠ¹ãªè¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
          return null;
        }

        if (hasMinuteError) {
          alert("åˆ†ãŒ00ä»¥å¤–ã®è¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚åˆ†ã¯ã™ã¹ã¦00ã¨ã—ã¦æ‰±ã„ã¾ã—ãŸã€‚");
        }

        return slots;
      }

      // ã€Œã“ã®è¨­å®šã§æ™‚é–“å¸¯ã‚’è‡ªå‹•ç”Ÿæˆã€ãƒœã‚¿ãƒ³
      slotConfigGenerateBtn?.addEventListener("click", async () => {
        const result = generateSlotsFromInputs();
        if (!result) return;
        const { slots, start, end, intervalMinutes } = result;

        try {
          await timeSlotsConfigRef.set(
            { start, end, intervalMinutes, slots },
            { merge: true }
          );
          renderSlotOptions(slots, false);
          updateSlotCustomTextarea(slots);
          setTaskStatus(
            "æ™‚é–“å¸¯ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚ã“ã®ã‚ã¨å„æ™‚é–“å¸¯ã®ã‚¿ã‚¹ã‚¯ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ã€‚",
            true
          );
        } catch (e) {
          console.error("timeSlotsConfig ä¿å­˜ã‚¨ãƒ©ãƒ¼", e);
          setTaskStatus("æ™‚é–“å¸¯ãƒªã‚¹ãƒˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", false);
        }
      });

      // ã€Œç¾åœ¨ã®æ™‚é–“å¸¯ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å±•é–‹ã€
      slotCustomLoadBtn?.addEventListener("click", async () => {
        try {
          const snap = await timeSlotsConfigRef.get();
          let slots;
          if (snap.exists) {
            const data = snap.data() || {};
            slots = Array.isArray(data.slots) ? data.slots : getDefaultSlots();
          } else {
            slots = getDefaultSlots();
          }
          updateSlotCustomTextarea(slots);
          setTaskStatus("ç¾åœ¨ã®æ™‚é–“å¸¯ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å±•é–‹ã—ã¾ã—ãŸã€‚", true);
        } catch (e) {
          console.error("slotCustomLoad ã‚¨ãƒ©ãƒ¼", e);
          setTaskStatus("æ™‚é–“å¸¯ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", false);
        }
      });

      // ã€Œã“ã®ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹ã§æ™‚é–“å¸¯ã‚’æ›´æ–°ã€
      slotCustomSaveBtn?.addEventListener("click", async () => {
        const slots = parseCustomSlotsFromTextarea();
        if (!slots) return;

        try {
          await timeSlotsConfigRef.set(
            { slots },   // ã‚«ã‚¹ã‚¿ãƒ ãªã®ã§ start/end/intervalMinutes ã¯çœç•¥
            { merge: true }
          );
          renderSlotOptions(slots, false);
          updateSlotCustomTextarea(slots);
          setTaskStatus(
            "ã‚«ã‚¹ã‚¿ãƒ æ™‚é–“å¸¯ã§ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚ã“ã®ã‚ã¨å„æ™‚é–“å¸¯ã®ã‚¿ã‚¹ã‚¯ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚",
            true
          );
        } catch (e) {
          console.error("slotCustomSave ã‚¨ãƒ©ãƒ¼", e);
          setTaskStatus("ã‚«ã‚¹ã‚¿ãƒ æ™‚é–“å¸¯ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", false);
        }
      });

      function setTaskStatus(msg, ok) {
        taskStatus.textContent = msg || "";
        taskStatus.className = "status " + (ok ? "ok" : "err");
      }

      async function loadSlotDefinition(slotId) {
        setTaskStatus("èª­ã¿è¾¼ã¿ä¸­â€¦", true);
        tasksAInput.value = "";
        tasksBInput.value = "";
        try {
          const snap = await taskSlotsRef.doc(slotId).get();
          if (!snap.exists) {
            setTaskStatus(
              "ã¾ã å®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚HTMLå´ã®åˆæœŸå€¤ãŒä½¿ã‚ã‚Œã¾ã™ã€‚",
              true
            );
            return;
          }
          const data = snap.data() || {};
          (data.tasksA || []).forEach((t, i) => {
            tasksAInput.value += (i ? "\n" : "") + t;
          });
          (data.tasksB || []).forEach((t, i) => {
            tasksBInput.value += (i ? "\n" : "") + t;
          });
          setTaskStatus("èª­ã¿è¾¼ã¿å®Œäº†ã€‚", true);
        } catch (e) {
          console.error(e);
          setTaskStatus("èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", false);
        }
      }

      reloadSlotBtn.addEventListener("click", () => {
        loadSlotDefinition(slotSelect.value);
      });
      slotSelect.addEventListener("change", () => {
        loadSlotDefinition(slotSelect.value);
      });

      saveSlotBtn.addEventListener("click", async () => {
        const slotId = slotSelect.value;
        const tasksA = tasksAInput.value
          .split("\n")
          .map((t) => t.trim())
          .filter((t) => t);
        const tasksB = tasksBInput.value
          .split("\n")
          .map((t) => t.trim())
          .filter((t) => t);

        setTaskStatus("ä¿å­˜ä¸­â€¦", true);
        try {
          await taskSlotsRef.doc(slotId).set({ tasksA, tasksB }, { merge: true });

          // ã“ã®æ™‚é–“å¸¯ã®ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã ã‘ãƒªã‚»ãƒƒãƒˆ
          const docSnap = await tasksDocRef.get();
          const data = docSnap.exists ? docSnap.data() : {};
          const checkedIds = (data.checkedIds || []).filter(
            (id) => !id.startsWith(slotId + "-")
          );
          await tasksDocRef.set(
            { checkedIds, businessKey: getCurrentBusinessKey() },
            { merge: true }
          );

          setTaskStatus(
            "ä¿å­˜ã—ã¾ã—ãŸï¼ˆã“ã®æ™‚é–“å¸¯ã®ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼‰ã€‚",
            true
          );
        } catch (e) {
          console.error(e);
          setTaskStatus("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", false);
        }
      });

      // åˆå›ãƒ­ãƒ¼ãƒ‰ï¼ˆæ™‚é–“å¸¯è¨­å®š â†’ ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ç”Ÿæˆ â†’ textareaåæ˜ ï¼‰
      loadTimeSlotsConfig(true);



      // =============================
      // 3) handoverTemplatesï¼ˆå¼•ãç¶™ããƒ¡ãƒ¢ç”¨ãƒœã‚¿ãƒ³ï¼‰
      // =============================
      const handoverChipsInput = document.getElementById("handoverChipsInput");
      const handoverReloadBtn = document.getElementById("handoverReloadBtn");
      const handoverSaveBtn = document.getElementById("handoverSaveBtn");
      const handoverStatus = document.getElementById("handoverStatus");
      const handoverPreview = document.getElementById("handoverPreview");
      const handoverTplRef = storeRef.collection("handoverTemplates").doc("global");

      function setHandoverStatus(msg, ok) {
        handoverStatus.textContent = msg || "";
        handoverStatus.className = "status " + (ok ? "ok" : "err");
      }

      function updateHandoverPreview(chips) {
        handoverPreview.innerHTML = "";
        if (!chips || chips.length === 0) {
          const span = document.createElement("span");
          span.className = "handover-preview-chip";
          span.textContent = "ï¼ˆãƒœã‚¿ãƒ³ãªã—ï¼‰";
          handoverPreview.appendChild(span);
          return;
        }
        chips.forEach((text) => {
          const chip = document.createElement("span");
          chip.className = "handover-preview-chip";
          chip.textContent = text;
          handoverPreview.appendChild(chip);
        });
      }

      async function loadHandoverTemplate() {
        setHandoverStatus("èª­ã¿è¾¼ã¿ä¸­â€¦", true);
        try {
          const snap = await handoverTplRef.get();
          const chips =
            snap.exists && Array.isArray(snap.data().chips)
              ? snap.data().chips
              : [];
          handoverChipsInput.value = chips.join("\n");
          updateHandoverPreview(chips);
          setHandoverStatus("èª­ã¿è¾¼ã¿å®Œäº†ã€‚", true);
        } catch (e) {
          console.error(e);
          setHandoverStatus("èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", false);
        }
      }

      handoverReloadBtn.addEventListener("click", loadHandoverTemplate);

      handoverSaveBtn.addEventListener("click", async () => {
        const chips = handoverChipsInput.value
          .split("\n")
          .map((t) => t.trim())
          .filter((t) => t);
        setHandoverStatus("ä¿å­˜ä¸­â€¦", true);
        try {
          await handoverTplRef.set({ chips }, { merge: true });
          updateHandoverPreview(chips);
          setHandoverStatus("ä¿å­˜ã—ã¾ã—ãŸã€‚", true);
        } catch (e) {
          console.error(e);
          setHandoverStatus("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", false);
        }
      });

      loadHandoverTemplate();

      // =============================
      // 4) shiftSheetï¼ˆã‚·ãƒ•ãƒˆè¡¨è¨­å®šï¼‰
      // =============================
      const shiftImageUrlInput = document.getElementById("shiftImageUrlInput");
      const shiftImageUrlSaveBtn = document.getElementById("shiftImageUrlSaveBtn");
      const shiftImagePreview = document.getElementById("shiftImagePreview");
      const shiftStatus = document.getElementById("shiftStatus");
      const shiftDocRef = storeRef.collection("settings").doc("shiftSheet");

      // Storage ã®å‚ç…§ã‚’ç”¨æ„
      const storage = firebase.storage();
      const shiftImageFileInput = document.getElementById("shiftImageFileInput");

      // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ Storage â†’ Firestore â†’ ç”»é¢åæ˜ 
      shiftImageFileInput?.addEventListener("change", async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        try {
          setShiftStatus("ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­â€¦", true);

          // ä¿å­˜å…ˆãƒ‘ã‚¹ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã®å‰ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ã‘ã¦è¢«ã‚Šé˜²æ­¢ï¼‰
          const storageRef = storage
            .ref()
            .child(`shiftSheets/${Date.now()}_${file.name}`);

          // Storage ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
          const snapshot = await storageRef.put(file);

          // å…¬é–‹URLã‚’å–å¾—
          const url = await snapshot.ref.getDownloadURL();

          // Firestore ã«ä¿å­˜ï¼ˆsettings/shiftSheet.imageUrlï¼‰
          await shiftDocRef.set({ imageUrl: url }, { merge: true });

          // ç”»é¢ã‚‚æ›´æ–°
          if (shiftImageUrlInput) {
            shiftImageUrlInput.value = url;
          }
          if (shiftImagePreview) {
            shiftImagePreview.src = url;
            shiftImagePreview.style.display = "block";
          }

          setShiftStatus("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼†URLä¿å­˜ãŒå®Œäº†ã—ã¾ã—ãŸã€‚", true);
        } catch (err) {
          console.error("ã‚·ãƒ•ãƒˆè¡¨ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼", err);
          setShiftStatus(
            "ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸï¼š" + (err.message || ""),
            false
          );
        } finally {
          // åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚‚ã†ä¸€å›é¸ã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹
          if (shiftImageFileInput) {
            shiftImageFileInput.value = "";
          }
        }
      });

      function setShiftStatus(msg, ok) {
        if (!shiftStatus) return;
        shiftStatus.textContent = msg || "";
        shiftStatus.className = "status " + (ok ? "ok" : "err");
      }

      // Firestore ã‹ã‚‰ç¾åœ¨ã®URLã‚’èª­ã¿è¾¼ã‚€
      async function loadShiftImageSetting() {
        if (!shiftImageUrlInput || !shiftImagePreview) return;
        setShiftStatus("èª­ã¿è¾¼ã¿ä¸­â€¦", true);

        try {
          const snap = await shiftDocRef.get();
          if (!snap.exists) {
            shiftImageUrlInput.value = "";
            shiftImagePreview.style.display = "none";
            setShiftStatus("ã¾ã ã‚·ãƒ•ãƒˆè¡¨ã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", true);
            return;
          }

          const data = snap.data() || {};
          const url = data.imageUrl || "";

          shiftImageUrlInput.value = url;
          if (url) {
            shiftImagePreview.src = url;
            shiftImagePreview.style.display = "block";
            setShiftStatus("èª­ã¿è¾¼ã¿å®Œäº†ã€‚", true);
          } else {
            shiftImagePreview.style.display = "none";
            setShiftStatus("URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", true);
          }
        } catch (e) {
          console.error("shiftSheet èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼", e);
          setShiftStatus(
            "èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸï¼š" + (e.message || ""),
            false
          );
        }
      }

      // ä¿å­˜ãƒœã‚¿ãƒ³ï¼ˆURLæ¬„ã®å†…å®¹ã‚’ãã®ã¾ã¾ä¿å­˜ï¼‰
      shiftImageUrlSaveBtn?.addEventListener("click", async () => {
        if (!shiftImageUrlInput) return;
        const url = shiftImageUrlInput.value.trim();

        setShiftStatus("ä¿å­˜ä¸­â€¦", true);
        try {
          await shiftDocRef.set({ imageUrl: url || null }, { merge: true });

          if (url) {
            shiftImagePreview.src = url;
            shiftImagePreview.style.display = "block";
          } else if (shiftImagePreview) {
            shiftImagePreview.style.display = "none";
          }

          setShiftStatus("ã‚·ãƒ•ãƒˆè¡¨URLã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚", true);
        } catch (e) {
          console.error("shiftSheet ä¿å­˜ã‚¨ãƒ©ãƒ¼", e);
          setShiftStatus(
            "ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸï¼š" + (e.message || ""),
            false
          );
        }
      });

      // ï¼ˆãŠã¾ã‘ï¼‰ã‚ªãƒ¼ãƒŠãƒ¼ç”»é¢ã‚’é–‹ã„ãŸç›´å¾Œã«ã‚‚ä¸€å›ã ã‘èª­ã¿è¾¼ã‚“ã§ãŠã
      loadShiftImageSetting();

      // =============================
      // 5) checklistLogsï¼ˆã‚¹ã‚¿ãƒƒãƒ•ãƒ­ã‚°ï¼‰
      // =============================
      const logDateInput = document.getElementById("logDate");
      const logDeviceInput = document.getElementById("logDevice");
      const logKeywordInput = document.getElementById("logKeyword");
      const logFilterBtn = document.getElementById("logFilterBtn");
      const logTableBody = document.getElementById("logTableBody");
      const logEmptyMsg = document.getElementById("logEmptyMsg");
      const logStatus = document.getElementById("logStatus");
      const logsColRef = storeRef.collection("checklistLogs");
      let logsUnsub = null;

      function setLogStatus(msg, ok) {
        logStatus.textContent = msg || "";
        logStatus.className = "status " + (ok ? "ok" : "err");
      }

      function renderLogs(docs, businessKey, deviceFilter) {
        logTableBody.innerHTML = "";
        logEmptyMsg.style.display = "none";

        if (docs.length === 0) {
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.colSpan = 5;
          td.textContent = "è©²å½“ã™ã‚‹ãƒ­ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
          tr.appendChild(td);
          logTableBody.appendChild(tr);

          logEmptyMsg.textContent =
            "å–¶æ¥­æ—¥: " +
            (businessKey || "æŒ‡å®šãªã—") +
            (deviceFilter ? " / ç«¯æœ«: " + deviceFilter : "");
          logEmptyMsg.style.display = "block";
          return;
        }

        docs.forEach((doc) => {
          const data = doc.data();
          const tr = document.createElement("tr");

          const createdAt = data.createdAt
            ? data.createdAt.toDate()
            : data.clientTimeISO
            ? new Date(data.clientTimeISO)
            : null;

          const timeTd = document.createElement("td");
          timeTd.textContent = createdAt
            ? createdAt.toLocaleTimeString("ja-JP", {
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit"
              })
            : "";

          const bkTd = document.createElement("td");
          bkTd.textContent = data.businessKey || "";

          const devTd = document.createElement("td");
          devTd.textContent = data.deviceLabel || "æœªè¨­å®š";

          const actionTd = document.createElement("td");
          actionTd.textContent = data.action || "";

          const taskTd = document.createElement("td");
          if (data.taskLabel) {
            taskTd.textContent = data.taskLabel;
          } else if (data.extra && data.extra.noteText) {
            taskTd.textContent = data.extra.noteText;
          } else {
            taskTd.textContent = "";
          }

          tr.appendChild(timeTd);
          tr.appendChild(bkTd);
          tr.appendChild(devTd);
          tr.appendChild(actionTd);
          tr.appendChild(taskTd);

          logTableBody.appendChild(tr);
        });
      }

      function startLogsListener() {
        const dateStr = logDateInput.value;
        const businessKey = businessKeyFromDateInput(dateStr);
        const deviceFilter = logDeviceInput.value.trim();
        const keywordRaw = logKeywordInput ? logKeywordInput.value.trim() : "";
        const keyword = keywordRaw.toLowerCase();

        if (!businessKey) {
          const todayKey = getCurrentBusinessKey();
          logDateInput.value = todayKey;
          return startLogsListener();
        }

        if (logsUnsub) {
          logsUnsub();
          logsUnsub = null;
        }

        setLogStatus("èª­ã¿è¾¼ã¿ä¸­â€¦", true);
        logTableBody.innerHTML =
          "<tr><td colspan='5'>ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>";
        logEmptyMsg.style.display = "none";

        logsUnsub = logsColRef
          .where("businessKey", "==", businessKey)
          .onSnapshot(
            (snapshot) => {
              let docs = [];
              snapshot.forEach((doc) => docs.push(doc));

              // createdAt é™é †ã‚½ãƒ¼ãƒˆ
              docs.sort((a, b) => {
                const da = a.data().createdAt
                  ? a.data().createdAt.toMillis()
                  : 0;
                const db = b.data().createdAt
                  ? b.data().createdAt.toMillis()
                  : 0;
                return db - da;
              });

              // â‘  ç«¯æœ«ãƒ©ãƒ™ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿
              if (deviceFilter) {
                docs = docs.filter(
                  (doc) => (doc.data().deviceLabel || "") === deviceFilter
                );
              }

              // â‘¡ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§å…¨æ–‡æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿
              if (keyword) {
                docs = docs.filter((doc) => {
                  const data = doc.data() || {};

                  const createdAt = data.createdAt
                    ? data.createdAt.toDate()
                    : data.clientTimeISO
                    ? new Date(data.clientTimeISO)
                    : null;

                  const timeStr = createdAt
                    ? createdAt.toLocaleTimeString("ja-JP", {
                        hour: "2-digit",
                        minute: "2-digit",
                        second: "2-digit",
                      })
                    : "";

                  const taskText = data.taskLabel
                    ? data.taskLabel
                    : data.extra && data.extra.noteText
                    ? data.extra.noteText
                    : "";

                  // æ¤œç´¢å¯¾è±¡ã‚’å…¨éƒ¨ãã£ã¤ã‘ã¦1æœ¬ã®æ–‡å­—åˆ—ã«ã™ã‚‹
                  const haystack = [
                    timeStr,                      // æ™‚åˆ»
                    data.businessKey || "",       // å–¶æ¥­æ—¥
                    data.deviceLabel || "æœªè¨­å®š", // ç«¯æœ«
                    data.action || "",            // æ“ä½œ
                    taskText || "",               // ã‚¿ã‚¹ã‚¯ / ãƒ¡ãƒ¢
                  ]
                    .join(" ")
                    .toLowerCase();

                  return haystack.includes(keyword);
                });
              }

              renderLogs(docs, businessKey, deviceFilter);
              setLogStatus(`èª­ã¿è¾¼ã¿å®Œäº†ï¼ˆ${docs.length}ä»¶ï¼‰`, true);
            },
            (error) => {
              console.error("checklistLogs èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼", error);
              setLogStatus("ãƒ­ã‚°ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", false);
              logTableBody.innerHTML =
                "<tr><td colspan='5'>ãƒ­ã‚°ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</td></tr>";
            }
          );
      }

      // æ—¥ä»˜ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒœã‚¿ãƒ³
      const logTodayBtn = document.getElementById("logTodayBtn");
      const logYesterdayBtn = document.getElementById("logYesterdayBtn");
      const logLast3Btn = document.getElementById("logLast3Btn"); // ã¾ã æœªå®Ÿè£…

      function setDateInputToToday() {
        logDateInput.value = getCurrentBusinessKey();
      }

      function setDateInputToYesterday() {
        const today = getCurrentBusinessKey(); // YYYY-MM-DD
        const [y, m, d] = today.split("-").map(Number);
        const dt = new Date(y, m - 1, d);
        dt.setDate(dt.getDate() - 1);
        const yy = dt.getFullYear();
        const mm = String(dt.getMonth() + 1).padStart(2, "0");
        const dd = String(dt.getDate()).padStart(2, "0");
        logDateInput.value = `${yy}-${mm}-${dd}`;
      }

      logTodayBtn?.addEventListener("click", () => {
        setDateInputToToday();
        startLogsListener();
      });

      logYesterdayBtn?.addEventListener("click", () => {
        setDateInputToYesterday();
        startLogsListener();
      });

      logLast3Btn?.addEventListener("click", () => {
        alert("ç›´è¿‘3æ—¥ã®é›†è¨ˆã¯ã‚ã¨ã§å®Ÿè£…ã—ã‚ˆã†ğŸ’¡ï¼ˆä»Šæ—¥ã¯æ—¥ä»˜1æ—¥ãšã¤è¦‹ã¦ã­ï¼‰");
      });

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒœã‚¿ãƒ³
      logFilterBtn.addEventListener("click", () => {
        startLogsListener();
      });

      // ç«¯æœ«ãƒ©ãƒ™ãƒ«ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã§ Enter æŠ¼ã—ãŸã‚‰æ¤œç´¢
      logDeviceInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") startLogsListener();
      });
      logKeywordInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") startLogsListener();
      });

      // åˆæœŸå€¤ï¼šä»Šæ—¥ã®å–¶æ¥­æ—¥
      logDateInput.value = getCurrentBusinessKey();
      startLogsListener();

      // =============================
      // 6) ã‚°ãƒ©ãƒ•åˆ†æï¼ˆanalyticsï¼‰
      // =============================
      const analyticsDateInput = document.getElementById("analyticsDate");
      const analyticsRunBtn = document.getElementById("analyticsRunBtn");
      const analyticsTotalCount = document.getElementById("analyticsTotalCount");
      const analyticsSummaryNote = document.getElementById("analyticsSummaryNote");
      const analyticsTableBody = document.getElementById("analyticsTableBody");
      const analyticsEmptyMsg = document.getElementById("analyticsEmptyMsg");
      const analyticsStatus = document.getElementById("analyticsStatus");
      const deviceChartCanvas = document.getElementById("deviceChartCanvas");

      let deviceChart = null;

      function setAnalyticsStatus(msg, ok) {
        analyticsStatus.textContent = msg || "";
        analyticsStatus.className = "status " + (ok ? "ok" : "err");
      }

      async function runAnalytics() {
        let businessKey = businessKeyFromDateInput(analyticsDateInput.value);
        if (!businessKey) {
          businessKey = getCurrentBusinessKey();
          analyticsDateInput.value = businessKey;
        }

        setAnalyticsStatus("é›†è¨ˆä¸­â€¦", true);
        analyticsTableBody.innerHTML =
          "<tr><td colspan='2'>é›†è¨ˆä¸­...</td></tr>";
        analyticsEmptyMsg.style.display = "none";
        analyticsTotalCount.textContent = "-";
        analyticsSummaryNote.textContent = "";

        try {
          const snapshot = await logsColRef
            .where("businessKey", "==", businessKey)
            .get();

          if (snapshot.empty) {
            analyticsTableBody.innerHTML =
              "<tr><td colspan='2'>ã“ã®å–¶æ¥­æ—¥ã®ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>";
            analyticsEmptyMsg.textContent = "å–¶æ¥­æ—¥: " + businessKey;
            analyticsEmptyMsg.style.display = "block";
            analyticsTotalCount.textContent = "0";
            analyticsSummaryNote.textContent = "ãƒã‚§ãƒƒã‚¯ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
            if (deviceChart) {
              deviceChart.destroy();
              deviceChart = null;
            }
            setAnalyticsStatus("é›†è¨ˆå®Œäº†ï¼ˆ0ä»¶ï¼‰", true);
            return;
          }

          const perDevice = {};
          let total = 0;

          snapshot.forEach((doc) => {
            const data = doc.data() || {};
            const actionStr = (data.action || "").toLowerCase();

            // â˜…å®Œäº†æ‰±ã„ã®æ¡ä»¶ï¼š
            // action ã« "check" or "on" ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’ã€Œãƒã‚§ãƒƒã‚¯ã—ãŸã€ã¨ã¿ãªã™
            if (!actionStr) return;
            if (!actionStr.includes("check") && !actionStr.includes("on")) return;

            const device = data.deviceLabel || "æœªè¨­å®š";
            perDevice[device] = (perDevice[device] || 0) + 1;
            total++;
          });

          // ãƒ†ãƒ¼ãƒ–ãƒ«æç”»
          analyticsTableBody.innerHTML = "";
          const devices = Object.keys(perDevice);

          if (devices.length === 0) {
            analyticsTableBody.innerHTML =
              "<tr><td colspan='2'>ã€Œãƒã‚§ãƒƒã‚¯å®Œäº†ã€ã¨ã¿ãªã›ã‚‹ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</td></tr>";
            analyticsEmptyMsg.textContent =
              "å–¶æ¥­æ—¥: " + businessKey + "ï¼ˆaction ã®æ¡ä»¶ã‚’èª¿æ•´ã™ã‚Œã°ã‚«ã‚¦ãƒ³ãƒˆãŒå¢—ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼‰";
            analyticsEmptyMsg.style.display = "block";
          } else {
            devices
              .sort((a, b) => (perDevice[b] || 0) - (perDevice[a] || 0))
              .forEach((device) => {
                const tr = document.createElement("tr");
                const tdDevice = document.createElement("td");
                const tdCount = document.createElement("td");
                tdDevice.textContent = device;
                tdCount.textContent = perDevice[device];
                tr.appendChild(tdDevice);
                tr.appendChild(tdCount);
                analyticsTableBody.appendChild(tr);
              });
          }

          analyticsTotalCount.textContent = String(total);
          analyticsSummaryNote.textContent =
            devices.length > 0
              ? `ç«¯æœ«æ•°: ${devices.length} / 1ç«¯æœ«ã‚ãŸã‚Šå¹³å‡ ${(total / devices.length).toFixed(1)} å›`
              : "å®Œäº†ãƒ­ã‚°ãŒãªã„ãŸã‚å¹³å‡ã¯ç®—å‡ºã§ãã¾ã›ã‚“ã€‚";

          // ã‚°ãƒ©ãƒ•æç”»
          if (deviceChart) {
            deviceChart.destroy();
            deviceChart = null;
          }
          if (devices.length > 0 && deviceChartCanvas) {
            const ctx = deviceChartCanvas.getContext("2d");
            deviceChart = new Chart(ctx, {
              type: "bar",
              data: {
                labels: devices,
                datasets: [
                  {
                    label: "ãƒã‚§ãƒƒã‚¯å›æ•°",
                    data: devices.map((d) => perDevice[d]),
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                      precision: 0,
                    },
                  },
                },
                plugins: {
                  legend: {
                    display: false,
                  },
                },
              },
            });
          }

          setAnalyticsStatus(`é›†è¨ˆå®Œäº†ï¼ˆ${total}å›ï¼‰`, true);
        } catch (e) {
          console.error("analytics é›†è¨ˆã‚¨ãƒ©ãƒ¼", e);
          analyticsTableBody.innerHTML =
            "<tr><td colspan='2'>é›†è¨ˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚</td></tr>";
          analyticsEmptyMsg.style.display = "none";
          if (deviceChart) {
            deviceChart.destroy();
            deviceChart = null;
          }
          analyticsTotalCount.textContent = "-";
          analyticsSummaryNote.textContent = "";
          setAnalyticsStatus("é›†è¨ˆã«å¤±æ•—ã—ã¾ã—ãŸï¼š" + (e.message || ""), false);
        }
      }

      analyticsRunBtn.addEventListener("click", () => {
        runAnalytics();
      });

      // activateView ã‹ã‚‰å‘¼ã¹ã‚‹ã‚ˆã†ã«å‚ç…§ã‚’æ¸¡ã—ã¦ãŠã
      runAnalyticsRef = runAnalytics;
      analyticsDateInputRef = analyticsDateInput;
    });



// ===== ã‚·ãƒ•ãƒˆè¡¨ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç‰ˆï¼‰ =====

// 6ã€œ23, 0ã€œ5 ã®é †ã§24æ™‚é–“
const SHIFT_HOURS = [6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5];

// ã¾ãšã¯ãƒ€ãƒŸãƒ¼ã§ã€Œãã‚Œã£ã½ã„ã€ãƒ‡ãƒ¼ã‚¿
const sampleShiftWeek = [
  {
    dateLabel: "12/1",
    youbi: "æœˆ",
    youbiClass: "",
    mh: "18:45",
    people: "3",
    shifts: [
      { name: "æ£®è„‡ ç›´ç¾",   start: "06:00", end: "11:00" },
      { name: "å®‡ç”°å· ç¾å¹¸", start: "11:00", end: "17:00" },
      { name: "åŒ—å°¾ é¾å“‰",   start: "17:00", end: "23:00" }
    ]
  },
  {
    dateLabel: "12/2",
    youbi: "ç«",
    youbiClass: "",
    mh: "24:26",
    people: "3",
    shifts: [
      { name: "æŸ³æ¥½ çœŸç”±ç¾", start: "06:00", end: "12:00" },
      { name: "å®‡ç”°å· æ¯å­", start: "12:00", end: "18:00" },
      { name: "ç”°å®®",         start: "18:00", end: "23:00" }
    ]
  },
  {
    dateLabel: "12/3",
    youbi: "æ°´",
    youbiClass: "",
    mh: "20:08",
    people: "3",
    shifts: [
      { name: "å²©ç”° åº·ä½‘",   start: "06:00", end: "12:00" },
      { name: "æ–°é–‹ æ²™è€¶",   start: "12:00", end: "18:00" },
      { name: "å®‡ç”°å· ç¾å¹¸", start: "18:00", end: "23:00" }
    ]
  },
  {
    dateLabel: "12/4",
    youbi: "æœ¨",
    youbiClass: "",
    mh: "28:32",
    people: "3",
    shifts: [
      { name: "æŸ³æ¥½ çœŸç”±ç¾", start: "06:00", end: "12:00" },
      { name: "ç”°å®®",         start: "12:00", end: "18:00" },
      { name: "åŒ—å°¾ é¾å“‰",   start: "18:00", end: "23:00" }
    ]
  },
  {
    dateLabel: "12/5",
    youbi: "é‡‘",
    youbiClass: "",
    mh: "29:35",
    people: "3",
    shifts: [
      { name: "æ–°é–‹ æ²™è€¶",   start: "06:00", end: "11:00" },
      { name: "å®‡ç”°å· ç¾å¹¸", start: "11:00", end: "17:00" },
      { name: "ç”°å®®",         start: "17:00", end: "23:00" }
    ]
  },
  {
    dateLabel: "12/6",
    youbi: "åœŸ",
    youbiClass: "sat",
    mh: "28:32",
    people: "3",
    shifts: [
      { name: "æ£®è„‡ ç›´ç¾",   start: "06:00", end: "12:00" },
      { name: "åŒ—å°¾ é¾å“‰",   start: "12:00", end: "18:00" },
      { name: "å²©ç”° åº·ä½‘",   start: "18:00", end: "23:00" }
    ]
  },
  {
    dateLabel: "12/7",
    youbi: "æ—¥",
    youbiClass: "sun",
    mh: "22:66",
    people: "2",
    shifts: [
      { name: "æ–°é–‹ æ²™è€¶",   start: "09:00", end: "18:00" },
      { name: "å®‡ç”°å· ç¾å¹¸", start: "18:00", end: "23:00" }
    ]
  }
];

function timeToHour(t) {
  const [h] = t.split(":");
  return parseInt(h, 10);
}

// 1æœ¬ã®ã‚·ãƒ•ãƒˆã‚’æ™‚é–“è»¸ã«æ²¿ã£ã¦ã‚»ãƒ«åŒ–
function renderShiftCells(shift, withSummary, dayMh, dayPeople) {
  const startH = timeToHour(shift.start);
  const endH   = timeToHour(shift.end);

  let html = "";

  for (let i = 0; i < SHIFT_HOURS.length; i++) {
    const h = SHIFT_HOURS[i];

    if (h === startH) {
      // å˜ç´”ã«ã€ŒåŒã˜æ—¥å†…ã§å®Œçµã™ã‚‹ã€ã‚±ãƒ¼ã‚¹ã ã‘æƒ³å®šï¼ˆ06ã€œ23ï¼‰
      const span = Math.max(1, endH - startH);
      html += `
        <td class="shiftboard-bar-cell" colspan="${span}">
          <div class="shiftboard-bar">
            <span class="shiftboard-bar-name">${shift.name}</span>
            <span class="shiftboard-bar-time">${shift.start}ã€œ${shift.end}</span>
          </div>
        </td>
      `;
      i += span - 1;
    } else if (h < startH || h >= endH) {
      html += `<td class="shiftboard-empty"></td>`;
    }
  }

  if (withSummary) {
    html += `<td class="shiftboard-col-mh">${dayMh || ""}</td>`;
    html += `<td class="shiftboard-col-people">${dayPeople || ""}</td>`;
  } else {
    html += `<td class="shiftboard-col-mh"></td>`;
    html += `<td class="shiftboard-col-people"></td>`;
  }

  return html;
}

// 1æ—¥ã¶ã‚“ã‚’è¤‡æ•°è¡Œã«å±•é–‹
function renderDayRows(day) {
  const rowCount = Math.max(day.shifts.length, 1);
  let html = "";

  day.shifts.forEach((shift, index) => {
    const withSummary = index === 0;
    html += "<tr>";

    if (index === 0) {
      html += `
        <td class="shiftboard-col-date" rowspan="${rowCount}">
          <div class="shiftboard-date-main">${day.dateLabel}</div>
          <div class="shiftboard-date-week ${day.youbiClass || ""}">${day.youbi}</div>
        </td>
      `;
    }

    html += renderShiftCells(shift, withSummary, day.mh, day.people);
    html += "</tr>";
  });

  return html;
}

function renderShiftBoard(week) {
  const tbody = document.getElementById("shiftboardBody");
  if (!tbody) return;
  tbody.innerHTML = week.map(renderDayRows).join("");
}

document.addEventListener("DOMContentLoaded", () => {
  // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿æç”»
  renderShiftBoard(sampleShiftWeek);

  const printBtn = document.getElementById("shiftPrintBtn");
  if (printBtn) {
    printBtn.addEventListener("click", () => {
      window.print();
    });
  }
});





    
  </script>
</body>
</html>
